{
  "version": 3,
  "sources": ["../../typescript/globals.ts", "../../typescript/pageObserver.ts", "../../typescript/leerling/observer.ts", "../../typescript/lessen/scrape.ts", "../../typescript/lessen/convert.ts", "../../typescript/def.ts", "../../typescript/lessen/build.ts", "../../typescript/lessen/observer.ts", "../../typescript/les/observer.ts", "../../typescript/academie/observer.ts", "../../typescript/werklijst/buildUren.ts", "../../typescript/werklijst/scrapeUren.ts", "../../typescript/cloud.ts", "../../typescript/table/tableNavigation.ts", "../../typescript/progressBar.ts", "../../typescript/table/tableDef.ts", "../../typescript/werklijst/criteria.ts", "../../typescript/pageState.ts", "../../typescript/werklijst/prefillInstruments.ts", "../../typescript/pageHandlers.ts", "../../typescript/table/tableHeaders.ts", "../../typescript/werklijst/observer.ts", "../../typescript/table/observer.ts", "../../typescript/setupPowerQuery.ts", "../../typescript/pages/observer.ts", "../../typescript/main.ts"],
  "sourcesContent": ["type Options = {\r\n  showDebug: boolean;\r\n    otherAcademies: string;\r\n    showNotAssignedClasses: boolean;\r\n};\r\nexport const options: Options = {\r\n    showDebug: false,\r\n    otherAcademies: \"\",\r\n    showNotAssignedClasses: true\r\n};\r\n\r\nexport let observers = [];\r\n\r\nexport function db3(message: any) {\r\n    if (options?.showDebug) {\r\n        console.log(message);\r\n        console.log(Error().stack.split(\"\\n\")[2]);\r\n    }\r\n}\r\n\r\nexport function createValidId(id: string) {\r\n    return id\r\n        .replaceAll(\" \", \"\")\r\n        .normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\")\r\n        .replace(/\\W/g,'');\r\n}\r\n\r\n\r\nexport function registerObserver(observer) {\r\n    observers.push(observer);\r\n    if(observers.length > 10) //just in case...\r\n        console.error(\"Too many observers!\");\r\n}\r\n\r\n// noinspection JSUnusedGlobalSymbols\r\nexport function searchText(text: string) {\r\n    let input: HTMLInputElement = document.querySelector(\"#snel_zoeken_veld_zoektermen\");\r\n    input.value = text;\r\n    let evUp = new KeyboardEvent(\"keyup\", {key: \"Enter\", keyCode: 13, bubbles: true});\r\n    input.dispatchEvent(evUp);\r\n}\r\n\r\nexport function setButtonHighlighted(buttonId: string, show: boolean) {\r\n    if (show) {\r\n        document.getElementById(buttonId).classList.add(\"toggled\");\r\n    } else {\r\n        document.getElementById(buttonId).classList.remove(\"toggled\");\r\n    }\r\n}\r\n\r\nexport function addButton(targetElement: HTMLElement, buttonId: string, title: string, clickFunction: (ev:PointerEvent) => void, imageId: string, classList: string[], text = \"\", where: InsertPosition = \"beforebegin\") {\r\n    let button = document.getElementById(buttonId);\r\n    if (button === null) {\r\n        const button = document.createElement(\"button\");\r\n        button.classList.add(\"btn\"/*, \"btn-sm\", \"btn-outline-secondary\", \"w-100\"*/, ...classList);\r\n        button.id = buttonId;\r\n        button.style.marginTop = \"0\";\r\n        button.onclick = clickFunction;\r\n        button.title = title;\r\n        if(text) {\r\n            let span = document.createElement(\"span\");\r\n            button.appendChild(span);\r\n            span.innerText = text;\r\n        }\r\n        const buttonContent = document.createElement(\"i\");\r\n        button.appendChild(buttonContent);\r\n        buttonContent.classList.add(\"fas\", imageId);\r\n        targetElement.insertAdjacentElement(where, button);\r\n    }\r\n}\r\n\r\nexport function getSchooljaarSelectElement() {\r\n    let selects = document.querySelectorAll(\"select\");\r\n    return Array.from(selects)\r\n        .filter((element) => element.id.includes(\"schooljaar\"))\r\n        .pop();\r\n}\r\n\r\nexport function getSchooljaar() {\r\n    let el = getSchooljaarSelectElement();\r\n    if(el)\r\n        return el.value;\r\n    el = document.querySelector(\"div.alert-info\");\r\n    return el.textContent.match(/schooljaar *= (\\d{4}-\\d{4})*/)[1];\r\n}\r\n\r\nexport function getUserAndSchoolName() {\r\n    let footer = document.querySelector(\"body > main > div.row > div.col-auto.mr-auto > small\");\r\n    const reInstrument = /.*Je bent aangemeld als (.*)\\s@\\s(.*)\\./;\r\n    const match = footer.textContent.match(reInstrument);\r\n    if (match?.length !== 3) {\r\n        throw new Error(`Could not process footer text \"${footer.textContent}\"`);\r\n    }\r\n    let userName = match[1];\r\n    let schoolName = match[2];\r\n    return {userName, schoolName};\r\n}\r\n\r\nexport function getSchoolIdString() {\r\n    let {schoolName} = getUserAndSchoolName();\r\n    schoolName = schoolName\r\n        .replace(\"Academie \", \"\")\r\n        .replace(\"Muziek\", \"M\")\r\n        .replace(\"Woord\", \"W\")\r\n        .toLowerCase();\r\n    return createValidId(schoolName);\r\n}\r\n\r\nexport function millisToString(duration: number) {\r\n    let seconds = Math.floor((duration / 1000) % 60);\r\n    let minutes = Math.floor((duration / (1000 * 60)) % 60);\r\n    let hours = Math.floor((duration / (1000 * 60 * 60)) % 24);\r\n    let days = Math.floor((duration / (1000 * 60 * 60 * 24)));\r\n\r\n    if (days > 0)\r\n        return days + (days === 1 ? \" dag\" : \" dagen\");\r\n    else if (hours > 0)\r\n        return hours + \" uur\";\r\n    else if (minutes > 0)\r\n        return minutes + (minutes === 1 ? \" minuut\" : \" minuten\");\r\n    else if (seconds > 0)\r\n        return seconds + \" seconden\";\r\n    else return \"\";\r\n}\r\n\r\nexport function clamp(value: number, min: number, max: number) {\r\n    return Math.min(Math.max(value, min), max);\r\n}\r\n\r\nexport function isAlphaNumeric(str: string) {\r\n    if (str.length > 1)\r\n        return false;\r\n    let code: number;\r\n    let i: number;\r\n    let len: number;\r\n\r\n    for (i = 0, len = str.length; i < len; i++) {\r\n        code = str.charCodeAt(i);\r\n        if (!(code > 47 && code < 58) && // numeric (0-9)\r\n            !(code > 64 && code < 91) && // upper alpha (A-Z)\r\n            !(code > 96 && code < 123)) { // lower alpha (a-z)\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function rangeGenerator(start: number, stop: number, step = 1): number[] {\r\n    return Array(Math.ceil((stop - start) / step)).fill(start).map((x, y) => x + y * step);\r\n}", "interface PageFilter {\r\n    match: () => boolean;\r\n}\r\n\r\nexport class HashPageFilter implements PageFilter{\r\n    private readonly urlHash: string;\r\n    constructor(urlHash: string) {\r\n        this.urlHash = urlHash;\r\n    }\r\n\r\n    match() {\r\n        return window.location.hash.startsWith(this.urlHash);\r\n    }\r\n}\r\n\r\nexport class ExactHashPageFilter implements PageFilter{\r\n    private readonly urlHash: string;\r\n    constructor(urlHash: string) {\r\n        this.urlHash = urlHash;\r\n    }\r\n\r\n    match() {\r\n        return window.location.hash === this.urlHash;\r\n    }\r\n}\r\n\r\nexport class AllPageFilter implements PageFilter{\r\n    constructor() {\r\n    }\r\n\r\n    match() {\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class BaseObserver {\r\n    private readonly onPageChangedCallback: () => void;\r\n    private pageFilter: PageFilter;\r\n    private readonly onMutation: (mutation: MutationRecord) => boolean;\r\n    private observer: MutationObserver;\r\n    constructor(onPageChangedCallback: () => void, pageFilter: PageFilter, onMutationCallback: (mutation: MutationRecord) => boolean) {\r\n        this.onPageChangedCallback = onPageChangedCallback;\r\n        this.pageFilter = pageFilter;\r\n        this.onMutation = onMutationCallback;\r\n        if (onMutationCallback) {\r\n            this.observer = new MutationObserver((mutationList, observer) => this.observerCallback(mutationList, observer));\r\n        }\r\n    }\r\n\r\n    observerCallback(mutationList: MutationRecord[] , _observer: MutationObserver) {\r\n        for (const mutation of mutationList) {\r\n            if (mutation.type !== \"childList\") {\r\n                continue;\r\n            }\r\n            if (this.onMutation(mutation)) {\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    onPageChanged() {\r\n        if (!this.pageFilter.match()) {\r\n            this.disconnect();\r\n            return;\r\n        }\r\n        if (this.onPageChangedCallback) {\r\n            this.onPageChangedCallback();\r\n        }\r\n        if (!this.onMutation)\r\n            return;\r\n        this.observeElement(document.querySelector(\"main\"));\r\n    }\r\n\r\n    observeElement(element: HTMLElement) {\r\n        if (!element) {\r\n            console.error(\"Can't attach observer to element.\");\r\n            return;\r\n        }\r\n\r\n        const config = {\r\n            attributes: false,\r\n            childList: true,\r\n            subtree: true\r\n        };\r\n        this.observer.observe(element, config);\r\n    }\r\n\r\n    disconnect() {\r\n        this.observer?.disconnect();\r\n    }\r\n}\r\n\r\nexport class HashObserver {\r\n    private baseObserver: BaseObserver;\r\n    constructor(urlHash: string, onMutationCallback: (mutation: MutationRecord) => boolean) {\r\n        this.baseObserver = new BaseObserver(undefined, new HashPageFilter(urlHash), onMutationCallback);\r\n    }\r\n\r\n    onPageChanged() {\r\n        this.baseObserver.onPageChanged();\r\n    }\r\n}\r\nexport class ExactHashObserver {\r\n    private baseObserver: BaseObserver;\r\n    constructor(urlHash: string, onMutationCallback: (mutation: MutationRecord) => boolean) {\r\n        this.baseObserver = new BaseObserver(undefined, new ExactHashPageFilter(urlHash), onMutationCallback);\r\n    }\r\n\r\n    onPageChanged() {\r\n        this.baseObserver.onPageChanged();\r\n    }\r\n}\r\n\r\nexport class PageObserver {\r\n    private baseObserver: BaseObserver;\r\n    constructor(onPageChangedCallback: () => void) {\r\n        this.baseObserver = new BaseObserver(onPageChangedCallback, new AllPageFilter(), undefined);\r\n    }\r\n\r\n    onPageChanged() {\r\n        this.baseObserver.onPageChanged();\r\n    }\r\n}", "import {db3, getSchooljaarSelectElement, options} from \"../globals.js\";\r\nimport {HashObserver} from \"../pageObserver.js\";\r\n\r\nexport default new HashObserver(\"#leerlingen-leerling\", onMutation);\r\n\r\nfunction onMutation(mutation: MutationRecord) {\r\n    let tabInschrijving = document.getElementById(\"leerling_inschrijvingen_weergave\");\r\n    if (mutation.target === tabInschrijving) {\r\n        onInschrijvingChanged(tabInschrijving);\r\n        return true;\r\n    }\r\n    if ((mutation.target as HTMLElement).id.includes(\"_uitleningen_table\")){\r\n        onUitleningenChanged(mutation.target as HTMLElement);\r\n        return true;\r\n    }\r\n    let tabAttesten = document.getElementById(\"attesten\");\r\n    if (mutation.target === tabAttesten) {\r\n        onAttestenChanged(tabInschrijving);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction onAttestenChanged(_tabInschrijving: HTMLElement) {\r\n    decorateSchooljaar();\r\n}\r\n\r\nfunction onUitleningenChanged(tableUitleningen: HTMLElement) {\r\n    let firstCells :NodeListOf<HTMLTableCellElement> = tableUitleningen.querySelectorAll(\"tbody > tr > td:first-child\");\r\n    for(let cell of firstCells) {\r\n        if (cell.classList.contains(\"text-muted\")) {\r\n            break;//empty table with fake row.\r\n        }\r\n        let anchor = document.createElement(\"a\");\r\n        anchor.innerText = cell.innerText;\r\n        anchor.setAttribute(\"href\", \"/#extra-assets-uitleningen-uitlening?id=\"+anchor.innerText);\r\n        cell.textContent = \"\";\r\n        cell.appendChild(anchor);\r\n    }\r\n}\r\n\r\nfunction getSchooljaarElementAndListen() {\r\n    let schooljaar = getSchooljaarSelectElement();\r\n    let listening = \"changeListerenAdded\";\r\n    if(!schooljaar?.classList.contains(listening)){\r\n        schooljaar?.classList.add(listening);\r\n        schooljaar?.addEventListener(\"click\", () => {\r\n           decorateSchooljaar();\r\n        });\r\n    }\r\n    return schooljaar;\r\n}\r\n\r\nfunction isActiveYear() {\r\n    let selectedYearElement = getSchooljaarElementAndListen();\r\n    if(!selectedYearElement)\r\n        return true;\r\n    let selectedYear = parseInt(selectedYearElement.value);//only parses the first valid number in the string.\r\n    let now = new Date();\r\n    let month = now.getMonth();\r\n    let registrationSchoolYearStart = now.getFullYear();\r\n    if (month <= 3) {\r\n        registrationSchoolYearStart--;\r\n    }\r\n    return selectedYear === registrationSchoolYearStart;\r\n}\r\n\r\nfunction decorateSchooljaar() {\r\n    let view = document.getElementById(\"view_contents\");\r\n    let activeYear = isActiveYear();\r\n    if (activeYear) {\r\n        view.classList.remove(\"oldYear\");\r\n    } else {\r\n        view.classList.add(\"oldYear\");\r\n    }\r\n    if(!activeYear) {\r\n        let toewijzingButtons = document.querySelectorAll(\"#leerling_inschrijvingen_weergave button\");\r\n        Array.from(toewijzingButtons)\r\n            .filter((el) => (el.textContent === \"toewijzing\") || (el.textContent === \"inschrijving\"))\r\n            .forEach((btn) => btn.classList.add(\"oldYear\"));\r\n    }\r\n}\r\n\r\nfunction onInschrijvingChanged(tabInschrijving: HTMLElement) {\r\n    db3(\"inschrijving (tab) changed.\");\r\n\r\n    decorateSchooljaar();\r\n\r\n    //Show trimester instruments.\r\n    let moduleButtons = tabInschrijving.querySelectorAll(\"tr td.right_center > button\");\r\n    for(let btn of moduleButtons) {\r\n        let onClick = btn.getAttribute(\"onclick\");\r\n        let tr = btn.parentNode.parentNode;\r\n        onClick = onClick.substring(10, onClick.length- 1);\r\n        let args = onClick\r\n            .split(\", \")\r\n            .map((arg) => arg.replaceAll(\"'\", \"\"));\r\n        // @ts-ignore\r\n        getModules(...args)//TODO: making assumptions about the arguments here.\r\n            .then((modNames) => {\r\n                let instrumentText = \"\";\r\n                if(modNames.length) {\r\n                    (tr.children[0] as HTMLTableCellElement).innerText += \": \";\r\n                    let rx = /Initiatie (.*) - trimester.*/;\r\n                    instrumentText += modNames\r\n                        .map(modName => {\r\n                            let matches = modName.match(rx);\r\n                            if (matches.length >= 1) {\r\n                                return matches[1];\r\n                            } else {\r\n                                return \": ???\";\r\n                            }\r\n                        })\r\n                        .join(\", \");\r\n                }\r\n                let span = document.createElement(\"span\");\r\n                tr.children[0].appendChild(span);\r\n                if(modNames.length > 1) {\r\n                    span.classList.add(\"badge-warning\");\r\n                }\r\n                span.innerText = instrumentText;\r\n            });\r\n    }\r\n\r\n    if(options.showNotAssignedClasses) {\r\n        setStripedLessons();\r\n    }\r\n\r\n}\r\n\r\nfunction setStripedLessons() {\r\n    let classRows = document.querySelectorAll(\"#leerling_inschrijvingen_weergave tr\");\r\n    let classCells = Array.from(classRows)\r\n        .filter(row => row.querySelector(\".table-info\") !== null)\r\n        .map(row => row.children.item(row.children.length - 2));\r\n\r\n    for (let td of classCells) {\r\n        let classDate = td.querySelector(\"span.text-muted\");\r\n        if (!classDate)\r\n            continue;\r\n        if (classDate.textContent === \"(geen lesmomenten)\")\r\n            continue;\r\n        for (let tdd of td.parentElement.children) {\r\n            if (tdd.classList.contains(\"table-info\")) {\r\n                tdd.classList.add(\"runningStripes\");\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nasync function getModules(size,modal,file,args) {\r\n    // let folder = modal.split(\"-\").join(\"/\");\r\n\r\n    // This call is being skipped: (probably ok)\r\n    // let res = await fetch('views/'+folder+'/'+file+'.modal.php?'+args);\r\n    // let text = await res.text();\r\n\r\n    // This call uses the `args` param, although that contains an extra schooljaar paran which is not really needed.\r\n    // > 'inschrijving_vak_id=289840&schooljaar=2024-2025&lesmoment_id=4102'\r\n    // let lesmoment_id = args.substring(args.lastIndexOf(\"=\")+1);\r\n    // let res2 = await fetch(\"/views/leerlingen/leerling/inschrijvingen/modules_kiezen.modules.div.php?inschrijving_vak_id=289840&lesmoment_id=\" + lesmoment_id);\r\n    let res2 = await fetch(\"/views/leerlingen/leerling/inschrijvingen/modules_kiezen.modules.div.php?\"+args);\r\n\r\n    let text2 = await res2.text();\r\n    const template = document.createElement('template');\r\n    template.innerHTML = text2;\r\n    let checks = template.content.querySelectorAll(\"i.fa-check-square\");\r\n    return Array.from(checks)\r\n        .map(check => check.parentNode.parentNode.parentNode.querySelector(\"strong\").textContent);\r\n}\r\n\r\n", "import { db3 } from \"../globals.js\";\r\n\r\nexport function scrapeLessenOverzicht() {\r\n    let table = document.getElementById(\"table_lessen_resultaat_tabel\") as HTMLTableElement;\r\n    let body = table.tBodies[0];\r\n    let lessen: Les[] = [];\r\n    for (const row of body.rows) {\r\n        let lesInfo = row.cells[0];\r\n        let studentsCell = row.cells[1];\r\n        let les = scrapeLesInfo(lesInfo);\r\n        les.tableRow = row;\r\n        les.studentsTable = studentsCell.querySelectorAll(\"table\")[0]; //for delayed student scraping.\r\n        let smallTags = studentsCell.querySelectorAll(\"small\");\r\n        //aantallen\r\n        let arrayLeerlingenAantal = Array.from(smallTags).map((item) => item.textContent).filter((txt) => txt.includes(\"leerlingen\"));\r\n        if (arrayLeerlingenAantal.length > 0) {\r\n            let reAantallen = /(\\d+).\\D+(\\d+)/;\r\n            let matches = arrayLeerlingenAantal[0].match(reAantallen);\r\n            les.aantal = parseInt(matches[1]);\r\n            les.maxAantal = parseInt(matches[2]);\r\n        }\r\n        //id\r\n        let idTag = Array.from(smallTags).find((item) => item.classList.contains(\"float-right\"));\r\n        les.id = idTag.textContent;\r\n        //wachtlijst\r\n        les.wachtlijst = 0;\r\n        let arrayWachtlijst = Array.from(smallTags).map((item) => item.textContent).filter((txt) => txt.includes(\"wachtlijst\"));\r\n        if (arrayWachtlijst.length > 0) {\r\n            let reWachtlijst = /(\\d+)/;\r\n            let matches = arrayWachtlijst[0].match(reWachtlijst);\r\n            les.wachtlijst = parseInt(matches[1]);\r\n        }\r\n\r\n        lessen.push(les);\r\n    }\r\n    return lessen;\r\n}\r\n\r\nexport function scrapeModules() {\r\n    let lessen = scrapeLessenOverzicht();\r\n    let modules = lessen.filter((les) => les.isModule);\r\n\r\n    for (let module of modules) {\r\n        module.students = scrapeStudents(module.studentsTable);\r\n\r\n        //get name of instrument and trimester.\r\n        const reInstrument = /.*\\Snitiatie\\s*(\\S+).*(\\d).*/;\r\n        const match = module.naam.match(reInstrument);\r\n        if (match?.length !== 3) {\r\n            console.error(`Could not process module \"${module.naam}\" (${module.id}).`);\r\n            continue;\r\n        }\r\n        module.instrumentName = match[1];\r\n        module.trimesterNo = parseInt(match[2]);\r\n    }\r\n\r\n    db3(modules);\r\n    return modules;\r\n}\r\n\r\nexport class StudentInfo {\r\n    graadJaar: string;\r\n    name: string;\r\n    instruments: Les[][];\r\n    allYearSame: boolean;\r\n    naam: string;\r\n    voornaam: string;\r\n    id: number;\r\n    info: string;\r\n}\r\n\r\nfunction scrapeStudents(studentTable: HTMLTableElement) {\r\n    let students: StudentInfo[] = [];\r\n    if(studentTable.tBodies.length === 0) {\r\n        return students;\r\n    }\r\n    for (const row of studentTable.tBodies[0].rows) {\r\n        let studentInfo = new StudentInfo();\r\n        studentInfo.graadJaar = row.cells[0].children[0].textContent;\r\n        studentInfo.name = row.cells[0].childNodes[1].textContent;\r\n        students.push(studentInfo);\r\n    }\r\n    return students;\r\n}\r\n\r\nexport class Les {\r\n    tableRow: HTMLTableRowElement;\r\n    vakNaam: string;\r\n    isModule: boolean;\r\n    alc: boolean;\r\n    visible: boolean;\r\n    naam: string;\r\n    teacher: string;\r\n    lesmoment: string;\r\n    vestiging: string;\r\n    studentsTable: HTMLTableElement;\r\n    aantal: number;\r\n    maxAantal: number;\r\n    id: string;\r\n    wachtlijst: number;\r\n    students: StudentInfo[];\r\n    instrumentName: string;\r\n    trimesterNo: number;\r\n}\r\n\r\nfunction scrapeLesInfo(lesInfo: HTMLElement) {\r\n    let les = new Les();\r\n    let [first] = lesInfo.getElementsByTagName(\"strong\");\r\n    les.vakNaam = first.textContent;\r\n    let badges = lesInfo.getElementsByClassName(\"badge\");\r\n    les.isModule = Array.from(badges).some((el) => el.textContent === \"module\");\r\n    les.alc = Array.from(badges).some((el) => el.textContent === \"ALC\");\r\n    les.visible = lesInfo.getElementsByClassName(\"fa-eye-slash\").length === 0;\r\n    let mutedSpans = lesInfo.querySelectorAll(\"span.text-muted\");\r\n    //muted spans contain:\r\n    //  - class name (optional)\r\n    //  - teacher name (always)\r\n    if(mutedSpans.length > 1) {\r\n        les.naam = mutedSpans.item(0).textContent;\r\n    } else {\r\n        les.naam = lesInfo.children[1].textContent;\r\n    }\r\n    if (mutedSpans.length > 0) {\r\n        les.teacher = Array.from(mutedSpans).pop().textContent;\r\n    }\r\n    let textNodes = Array.from(lesInfo.childNodes).filter((node) => node.nodeType === Node.TEXT_NODE);\r\n    if (!textNodes) return les;\r\n\r\n    les.lesmoment = textNodes[0].nodeValue;\r\n    les.vestiging = textNodes[1].nodeValue;\r\n    return les;\r\n}\r\n", "import {Les, StudentInfo} from \"./scrape.js\";\r\n\r\nfunction addTrimesters(instrument: any, inputModules: Les[]) {\r\n    let mergedInstrument: (Les | undefined)[] = [undefined, undefined, undefined];\r\n    let modulesForInstrument = inputModules.filter((module) => module.instrumentName === instrument.instrumentName);\r\n    for (let module of modulesForInstrument) {\r\n        mergedInstrument[module.trimesterNo-1] = module;\r\n    }\r\n    instrument.trimesters = mergedInstrument;\r\n}\r\n\r\nexport class InstrumentInfo {\r\n    teacher: string;\r\n    instrumentName: string;\r\n    maxAantal: number;\r\n    lesmoment: string;\r\n    vestiging: string;\r\n    trimesters: (Les| undefined)[];\r\n}\r\n\r\nexport interface TableData {\r\n    students : Map<string, StudentInfo>,\r\n    instruments: InstrumentInfo[]\r\n}\r\n\r\nexport function buildTableData(inputModules: Les[]) : TableData {\r\n    let tableData: TableData = {\r\n        students: new Map(),\r\n        instruments: []\r\n    };\r\n    //get all instruments\r\n    let instrumentNames = inputModules.map((module) => module.instrumentName);\r\n    let uniqueInstrumentNames: [string] = [...new Set(instrumentNames)] as [string];\r\n\r\n    for (let instrumentName of uniqueInstrumentNames) {\r\n        //get module instrument info\r\n        let instrumentInfo: InstrumentInfo = new InstrumentInfo();\r\n        let modules = inputModules.filter((module) => module.instrumentName === instrumentName);\r\n        instrumentInfo.instrumentName = instrumentName;\r\n        instrumentInfo.maxAantal = modules\r\n            .map((module) => module.maxAantal)\r\n            .reduce((prev, next) => {\r\n                return prev < next ? next : prev\r\n            }\r\n        );\r\n        let teachers = modules.map((module) => module.teacher);\r\n        let uniqueTeachers = [...new Set(teachers)];\r\n        instrumentInfo.teacher = uniqueTeachers.toString();\r\n\r\n        let reLesMoment = /.*(\\w\\w) (?:\\d+\\/\\d+ )?(\\d\\d:\\d\\d)-(\\d\\d:\\d\\d).*/;\r\n\r\n        let lesMomenten = modules.map((module) => {\r\n            let matches = module.lesmoment.match(reLesMoment);\r\n            if (matches?.length !== 4) {\r\n                console.error(`Could not process lesmoment \"${module.lesmoment}\" for instrument \"${instrumentName}\".`);\r\n                return \"???\";\r\n            }\r\n\r\n            return matches[1] + \" \" + matches[2] + \"-\" + matches[3];\r\n        });\r\n        let uniqueLesmomenten = [...new Set(lesMomenten)];\r\n        instrumentInfo.lesmoment = uniqueLesmomenten.toString();\r\n\r\n        let vestigingen = modules.map((module) => module.vestiging);\r\n        let uniqueVestigingen = [...new Set(vestigingen)];\r\n        instrumentInfo.vestiging = uniqueVestigingen.toString();\r\n        tableData.instruments.push(instrumentInfo);\r\n        addTrimesters(tableData.instruments[tableData.instruments.length-1], inputModules);\r\n\r\n       for (let trim of instrumentInfo.trimesters) {\r\n            addTrimesterStudentsToMapAndCount(tableData.students, trim);\r\n        }\r\n    }\r\n\r\n    for(let student of tableData.students.values()) {\r\n        let instruments = student.instruments.flat();\r\n        if (instruments.length < 3) {\r\n            student.allYearSame = false;\r\n            continue; //skip the every() below if we haven't got 3 instruments.\r\n        }\r\n        student.allYearSame = instruments\r\n            .every((instr: any) => instr.instrumentName === (student?.instruments[0][0]?.instrumentName ?? \"---\"));\r\n    }\r\n\r\n    for(let instrument of tableData.instruments) {\r\n        for (let trim of instrument.trimesters) {\r\n            sortTrimesterStudents(trim);\r\n        }\r\n    }\r\n\r\n    for(let student of tableData.students.values()) {\r\n        student.info = \"\";\r\n        for(let instrs of student.instruments) {\r\n            if(instrs.length) {\r\n                student.info += instrs[0].trimesterNo + \". \" + instrs.map(instr => instr.instrumentName) + \"\\n\";\r\n            } else {\r\n                student.info += \"?. ---\\n\";\r\n            }\r\n        }\r\n    }\r\n    return tableData;\r\n}\r\n\r\nfunction addTrimesterStudentsToMapAndCount(students: Map<string, StudentInfo>, trim: Les) {\r\n    if(!trim) return;\r\n    for (let student of trim.students) {\r\n        if (!students.has(student.name)) {\r\n            student.instruments = [[], [], []];\r\n            students.set(student.name, student);\r\n        }\r\n        let stud = students.get(student.name);\r\n        stud.instruments[trim.trimesterNo-1].push(trim);\r\n    }\r\n    //all trims must reference the students in the overall map.\r\n    trim.students = trim.students\r\n        .map((student) => students.get(student.name));\r\n}\r\n\r\nfunction sortTrimesterStudents(trim: Les) {\r\n    if(!trim) return;\r\n    let comparator = new Intl.Collator();\r\n    trim.students\r\n        //sort full year students on top.\r\n        .sort((a,b) => {\r\n            if (a.allYearSame && (!b.allYearSame)) {\r\n                return -1;\r\n            } else if ((!a.allYearSame) && b.allYearSame) {\r\n                return 1;\r\n            } else {\r\n                return comparator.compare(a.name, b.name);\r\n            }\r\n        });\r\n}\r\n", "export let PROGRESS_BAR_ID = \"progressBarFetch\";\r\nexport let PREFILL_INSTR_BTN_ID = \"prefillInstrButton\";\r\nexport let MAIL_BTN_ID = \"mailButton\";\r\nexport let DOWNLOAD_TABLE_BTN_ID = \"downloadTableButton\";\r\nexport const LESSEN_OVERZICHT_ID = \"lessen_overzicht\";\r\nexport const TRIM_BUTTON_ID = \"moduleButton\";\r\nexport const CHECKS_BUTTON_ID = \"checksButton\";\r\nexport const COUNT_BUTTON_ID = \"fetchAllButton\";\r\nexport const FULL_CLASS_BUTTON_ID = \"fullClassButton\";\r\nexport const TRIM_TABLE_ID = \"trimesterTable\";\r\nexport const COUNT_TABLE_ID = \"werklijst_uren\";\r\nexport const TRIM_DIV_ID = \"trimesterDiv\";\r\nexport const JSON_URL = \"https://europe-west1-ebo-tain.cloudfunctions.net/json\";\r\nexport const CACHE_INFO_ID =  \"dko3plugin_cacheInfo\";\r\nexport const TEMP_MSG_ID =  \"dko3plugin_tempMessage\";\r\n\r\nexport function isButtonHighlighted(buttonId: string) {\r\n    return document.getElementById(buttonId)?.classList.contains(\"toggled\");\r\n}\r\n\r\nexport const CACHE_DATE_SUFFIX = \"__date\";\r\nexport const POWER_QUERY_ID = \"savedPowerQuery\";\r\nexport const STORAGE_PAGE_STATE_KEY = \"pageState\";\r\nexport const WERKLIJST_TABLE_NAME_PROP = \"werklijstTableName\";\r\nexport const UREN_TELLER = \"urenTeller\";\r\nexport const UREN_TABLE_STATE_NAME = \"__uren__\";", "import {FULL_CLASS_BUTTON_ID, isButtonHighlighted, TRIM_DIV_ID} from \"../def.js\";\r\nimport {db3} from \"../globals.js\";\r\nimport {InstrumentInfo} from \"./convert.js\";\r\nimport {StudentInfo} from \"./scrape\";\r\n\r\nconst NBSP = 160;\r\n\r\nexport function buildTrimesterTable(instruments: InstrumentInfo[]) {\r\n    let trimDiv = document.getElementById(TRIM_DIV_ID);\r\n    let newTable = document.createElement(\"table\");\r\n    newTable.id = \"trimesterTable\";\r\n    newTable.style.width = \"100%\";\r\n\r\n    let col = document.createElement(\"col\");\r\n    col.setAttribute(\"width\", \"100\");\r\n    newTable.appendChild(col);\r\n    col = document.createElement(\"col\");\r\n    col.setAttribute(\"width\", \"100\");\r\n    newTable.appendChild(col);\r\n    col = document.createElement(\"col\");\r\n    col.setAttribute(\"width\", \"100\");\r\n    newTable.appendChild(col);\r\n\r\n    const newTableBody = document.createElement(\"tbody\");\r\n\r\n    let totTrim1 = 0;\r\n    let totTrim2 = 0;\r\n    let totTrim3 = 0;\r\n    for (let instrument of instruments) {\r\n        totTrim1 += instrument.trimesters[0].students.length;\r\n        totTrim2 += instrument.trimesters[1].students.length;\r\n        totTrim3 += instrument.trimesters[2].students.length;\r\n    }\r\n\r\n    //header\r\n    const tHead = document.createElement(\"thead\");\r\n    newTable.appendChild(tHead);\r\n    tHead.classList.add(\"table-secondary\")\r\n    const trHeader = document.createElement(\"tr\");\r\n    tHead.appendChild(trHeader);\r\n\r\n    const th1 = document.createElement(\"th\");\r\n    trHeader.appendChild(th1);\r\n    let div1 = document.createElement(\"div\");\r\n    th1.appendChild(div1);\r\n    let span1 = document.createElement(\"span\");\r\n    div1.appendChild(span1);\r\n    span1.classList.add(\"bold\");\r\n    span1.innerHTML = `Trimester 1`;\r\n    let spanTot1 = document.createElement(\"span\");\r\n    div1.appendChild(spanTot1);\r\n    spanTot1.classList.add(\"plain\");\r\n    spanTot1.innerHTML = ` (${totTrim1} lln) `;\r\n\r\n    const th2 = document.createElement(\"th\");\r\n    trHeader.appendChild(th2);\r\n    let div2 = document.createElement(\"div\");\r\n    th2.appendChild(div2);\r\n    let span2 = document.createElement(\"span\");\r\n    div2.appendChild(span2);\r\n    span2.classList.add(\"bold\");\r\n    span2.innerHTML = `Trimester 2`;\r\n    let spanTot2 = document.createElement(\"span\");\r\n    div2.appendChild(spanTot2);\r\n    spanTot2.classList.add(\"plain\");\r\n    spanTot2.innerHTML = ` (${totTrim2} lln) `;\r\n\r\n    const th3 = document.createElement(\"th\");\r\n    trHeader.appendChild(th3);\r\n    let div3 = document.createElement(\"div\");\r\n    th3.appendChild(div3);\r\n    let span3 = document.createElement(\"span\");\r\n    div3.appendChild(span3);\r\n    span3.classList.add(\"bold\");\r\n    span3.innerHTML = `Trimester 3`;\r\n    let spanTot3 = document.createElement(\"span\");\r\n    div3.appendChild(spanTot3);\r\n    spanTot3.classList.add(\"plain\");\r\n    spanTot3.innerHTML = ` (${totTrim3} lln) `;\r\n\r\n\r\n    // creating all cells\r\n    for (let instrument of instruments) {\r\n        buildInstrument(newTableBody, instrument);\r\n    }\r\n\r\n    // put the <tbody> in the <table>\r\n    newTable.appendChild(newTableBody);\r\n    // appends <table> into <body>\r\n    document.body.appendChild(newTable);\r\n    // sets the border attribute of newTable to '2'\r\n    newTable.setAttribute(\"border\", \"2\");\r\n    trimDiv.dataset.showFullClass= isButtonHighlighted(FULL_CLASS_BUTTON_ID) ? \"true\" : \"false\";\r\n    trimDiv.appendChild(newTable);\r\n}\r\n\r\nfunction buildInstrument(newTableBody: HTMLTableSectionElement, instrument: InstrumentInfo) {\r\n    // creates a table row\r\n    let headerRows = buildInstrumentHeader(newTableBody, instrument);\r\n    let studentTopRowNo = newTableBody.children.length;\r\n    let rowCount = Math.max(...instrument.trimesters\r\n        .map((trim) => {\r\n            if (!trim) return 0;\r\n            return trim.maxAantal > 100 ? 4 : trim.maxAantal;\r\n        }));\r\n    let hasWachtlijst = instrument.trimesters.find((trim) => (trim?.wachtlijst?? 0) > 0);\r\n    if (hasWachtlijst) {\r\n        rowCount++;\r\n    }\r\n\r\n    headerRows.trName.dataset.hasFullClass = \"false\";\r\n    headerRows.trModuleLinks.dataset.hasFullClass = \"false\";\r\n    let hasFullClass = false;\r\n    for (let rowNo = 0; rowNo < rowCount; rowNo++) {\r\n        let row = document.createElement(\"tr\");\r\n        newTableBody.appendChild(row);\r\n        row.classList.add(\"trimesterRow\");\r\n        row.dataset.hasFullClass = \"false\";\r\n\r\n        for (let trimNo = 0; trimNo < 3; trimNo++) {\r\n            let trimester = instrument.trimesters[trimNo];\r\n            let student: StudentInfo = undefined;\r\n            if (trimester) {\r\n                student = trimester.students[rowNo];\r\n                if (trimester.aantal >= trimester.maxAantal) {\r\n                    row.dataset.hasFullClass = \"true\";\r\n                    hasFullClass = true;\r\n                }\r\n            }\r\n            let cell = buildStudentCell(student);\r\n            row.appendChild(cell);\r\n            if (trimester.maxAantal <= rowNo) {\r\n                cell.classList.add(\"gray\");\r\n            }\r\n            if(student?.instruments[trimNo].length > 1) {\r\n                cell.classList.add(\"yellowMarker\");\r\n            }\r\n        }\r\n    }\r\n    if(hasFullClass) {\r\n        headerRows.trName.dataset.hasFullClass = \"true\";\r\n        headerRows.trModuleLinks.dataset.hasFullClass = \"true\";\r\n    }\r\n    if (!hasWachtlijst) {\r\n        return;\r\n    }\r\n\r\n    //build the wachtlijst row\r\n    for (let trimNo = 0; trimNo < 3; trimNo++) {\r\n        let colNo = trimNo;\r\n        let rowNo = newTableBody.children.length-1;\r\n        newTableBody.children[rowNo].classList.add(\"wachtlijst\");\r\n        let cell = newTableBody.children[rowNo].children[colNo];\r\n        cell.classList.add(\"wachtlijst\");\r\n        let trimester = instrument.trimesters[trimNo];\r\n        if ((trimester?.wachtlijst ?? 0) === 0) {\r\n            continue;\r\n        }\r\n        const small = document.createElement(\"small\");\r\n        cell.appendChild(small);\r\n        small.appendChild(document.createTextNode(`(${trimester.wachtlijst} op wachtlijst)`));\r\n        small.classList.add(\"text-danger\");\r\n\r\n        if (trimester.wachtlijst > 0 && trimester.aantal < trimester.maxAantal) {\r\n            cell.querySelector(\"small\").classList.add(\"yellowMarker\");\r\n            newTableBody.children[studentTopRowNo + trimester.aantal].children[colNo].classList.add(\"yellowMarker\");\r\n        }\r\n    }\r\n}\r\n\r\nfunction buildInstrumentHeader(newTableBody: HTMLTableSectionElement, instrument: InstrumentInfo) {\r\n    const trName = document.createElement(\"tr\");\r\n    newTableBody.appendChild(trName);\r\n    trName.classList.add(\"instrumentRow\");\r\n\r\n    const tdInstrumentName = document.createElement(\"td\");\r\n    trName.appendChild(tdInstrumentName);\r\n    tdInstrumentName.classList.add(\"instrumentName\", \"instrumentCell\");\r\n    tdInstrumentName.setAttribute(\"colspan\", \"3\");\r\n\r\n    let nameDiv = document.createElement(\"div\");\r\n    tdInstrumentName.appendChild(nameDiv);\r\n    nameDiv.classList.add(\"moduleName\");\r\n    nameDiv.appendChild(document.createTextNode(instrument.instrumentName));\r\n    let div = document.createElement(\"div\");\r\n    tdInstrumentName.appendChild(div);\r\n    div.classList.add(\"text-muted\");\r\n    div.appendChild(document.createTextNode(instrument.lesmoment));\r\n    div.appendChild(document.createElement(\"br\"));\r\n    div.appendChild(document.createTextNode(instrument.teacher));\r\n    div.appendChild(document.createElement(\"br\"));\r\n    div.appendChild(document.createTextNode(instrument.vestiging));\r\n\r\n    //build row for module links(the tiny numbered buttons)\r\n    const trModuleLinks = document.createElement(\"tr\");\r\n    newTableBody.appendChild(trModuleLinks);\r\n    trModuleLinks.classList.add(\"instrumentRow\");\r\n    const tdLink1 = document.createElement(\"td\");\r\n    trModuleLinks.appendChild(tdLink1);\r\n    trModuleLinks.classList.add(\"instrumentCell\");\r\n    if (instrument.trimesters[0]) {\r\n        tdLink1.appendChild(buildModuleButton(\"1\", instrument.trimesters[0].id));\r\n    }\r\n    const tdLink2 = document.createElement(\"td\");\r\n    trModuleLinks.appendChild(tdLink2);\r\n    trModuleLinks.classList.add(\"instrumentCell\");\r\n    if (instrument.trimesters[1]) {\r\n        tdLink2.appendChild(buildModuleButton(\"2\", instrument.trimesters[1].id));\r\n    }\r\n    const tdLink3 = document.createElement(\"td\");\r\n    trModuleLinks.appendChild(tdLink3);\r\n    trModuleLinks.classList.add(\"instrumentCell\");\r\n    if (instrument.trimesters[2]) {\r\n        tdLink3.appendChild(buildModuleButton(\"3\", instrument.trimesters[2].id));\r\n    }\r\n    return {\r\n        \"trName\": trName,\r\n        \"trModuleLinks\": trModuleLinks\r\n    };\r\n}\r\n\r\nfunction buildModuleButton(buttonText: string, id: string) {\r\n    const button = document.createElement(\"a\");\r\n    button.href = \"#\";\r\n    button.setAttribute(\"onclick\", `showView('lessen-les','','id=${id}'); return false;`);\r\n    button.classList.add(\"float-right\", \"trimesterButton\");\r\n    button.innerText = buttonText;\r\n    return button;\r\n}\r\n\r\nfunction buildStudentCell(student: StudentInfo) {\r\n    const cell = document.createElement(\"td\");\r\n    let studentSpan = document.createElement(\"span\");\r\n    studentSpan.appendChild(document.createTextNode(student?.name ??  String.fromCharCode(NBSP)));\r\n    cell.appendChild(studentSpan);\r\n    if (student?.allYearSame) {\r\n        studentSpan.classList.add(\"allYear\");\r\n    }\r\n    if (!student) {\r\n        return cell;\r\n    }\r\n\r\n    const anchor = document.createElement(\"a\");\r\n    cell.appendChild(anchor);\r\n    anchor.href = \"#\";\r\n    anchor.classList.add(\"pl-2\");\r\n    anchor.title = student.info;\r\n    anchor.onclick= function () {\r\n        fetchStudentId(student.name)\r\n            .then((id) => window.location.href = \"/?#leerlingen-leerling?id=\"+id+\",tab=inschrijvingen\");\r\n        return false;\r\n    };\r\n    const iTag = document.createElement(\"i\");\r\n    anchor.appendChild(iTag);\r\n    iTag.classList.add('fas', \"fa-user-alt\");\r\n    return cell;\r\n}\r\n\r\nasync function fetchStudentId(studentName: string) {\r\n    let studentNameForUrl = studentName.replaceAll(\",\", \"\").replaceAll(\"(\", \"\").replaceAll(\")\", \"\");\r\n    return fetch(\"/view.php?args=zoeken?zoek=\"+encodeURIComponent(studentNameForUrl))\r\n        .then((response) => response.text())\r\n        .then((_text) => fetch(\"/views/zoeken/index.view.php\"))\r\n        .then((response) => response.text())\r\n        .then((text) => findStudentId(studentName, text))\r\n        .catch(err => {\r\n            console.error('Request failed', err)\r\n        });\r\n}\r\n\r\nfunction findStudentId(studentName: string, text: string) {\r\n    db3(text);\r\n    studentName = studentName.replaceAll(\",\", \"\");\r\n    let namePos = text.indexOf(studentName);\r\n    if (namePos < 0) {\r\n        return -1\r\n    }\r\n    //the name comes AFTER the id, hence the backward search of the leftmost slice of the string.\r\n    let idPos = text.substring(0, namePos).lastIndexOf(\"'id=\", namePos);\r\n    let id = text.substring(idPos, idPos+10);\r\n    id = id.match(/\\d+/)[0]; //TODO: may fail!\r\n    db3(id);\r\n    return parseInt(id);\r\n}\r\n", "import {scrapeLessenOverzicht, scrapeModules} from \"./scrape.js\";\r\nimport {buildTableData} from \"./convert.js\";\r\nimport {buildTrimesterTable} from \"./build.js\";\r\nimport * as def from \"../def.js\";\r\nimport {setButtonHighlighted} from \"../globals.js\";\r\nimport {HashObserver} from \"../pageObserver.js\";\r\n\r\nexport default new HashObserver(\"#lessen-overzicht\", onMutation);\r\n\r\nfunction onMutation (mutation: MutationRecord) {\r\n    let lessenOverzicht = document.getElementById(def.LESSEN_OVERZICHT_ID);\r\n    if (mutation.target !== lessenOverzicht) {\r\n        return false;\r\n    }\r\n    let printButton = document.getElementById(\"btn_print_overzicht_lessen\") as HTMLButtonElement;\r\n    if (!printButton) {\r\n        return false;\r\n    }\r\n    onLessenOverzichtChanged(printButton);\r\n    return true;\r\n}\r\n\r\nfunction onLessenOverzichtChanged(printButton: HTMLButtonElement) {\r\n    //reset state\r\n    let overzichtDiv = document.getElementById(def.LESSEN_OVERZICHT_ID);\r\n    let trimDiv = document.getElementById(def.TRIM_DIV_ID);\r\n    if (!trimDiv) {\r\n        let trimDiv = document.createElement(\"div\");\r\n        let originalTable = document.getElementById(\"table_lessen_resultaat_tabel\");\r\n        originalTable.insertAdjacentElement(\"afterend\", trimDiv);\r\n        trimDiv.id = def.TRIM_DIV_ID;\r\n    }\r\n    overzichtDiv.dataset.filterFullClasses = \"false\";\r\n\r\n    let badges = document.getElementsByClassName(\"badge\");\r\n    let hasModules = Array.from(badges).some((el) => el.textContent === \"module\");\r\n    let hasAlc = Array.from(badges).some((el) => el.textContent === \"ALC\")\r\n    let warnings = document.getElementsByClassName(\"text-warning\");\r\n    let hasWarnings = warnings.length !==0;\r\n\r\n    let hasFullClasses = Array.from(warnings).map((item) => item.textContent).some((txt) => txt.includes(\"leerlingen\"));\r\n\r\n    if (!hasModules && !hasAlc && !hasWarnings && !hasFullClasses) {\r\n        return;\r\n    }\r\n    if (hasModules) {\r\n        addButton(printButton, def.TRIM_BUTTON_ID, \"Toon trimesters\", onClickShowTrimesters, \"fa-sitemap\");\r\n    }\r\n    if(hasAlc || hasWarnings) {\r\n        addButton(printButton, def.CHECKS_BUTTON_ID, \"Controleer lessen op fouten\", onClickCheckResults, \"fa-stethoscope\");\r\n    }\r\n    if(hasFullClasses) {\r\n        addButton(printButton, def.FULL_CLASS_BUTTON_ID, \"Filter volle klassen\", onClickFullClasses, \"fa-weight-hanging\");\r\n    }\r\n}\r\n\r\n\r\nfunction addButton(printButton: HTMLButtonElement, buttonId: string, title: string, clickFunction: (this: GlobalEventHandlers, ev: MouseEvent) => any, imageId: string) {\r\n    let button = document.getElementById(buttonId);\r\n    if (button === null) {\r\n        const button = document.createElement(\"button\",);\r\n        button.classList.add(\"btn\", \"btn-sm\", \"btn-outline-secondary\", \"w-100\");\r\n        button.id = buttonId;\r\n        button.style.marginTop = \"0\";\r\n        button.onclick = clickFunction;\r\n        button.title = title;\r\n        const buttonContent = document.createElement(\"i\");\r\n        button.appendChild(buttonContent);\r\n        buttonContent.classList.add(\"fas\", imageId);\r\n        printButton.insertAdjacentElement(\"beforebegin\", button);\r\n    }\r\n}\r\nfunction onClickCheckResults() {\r\n    let lessen = scrapeLessenOverzicht();\r\n\r\n    let table = document.getElementById(\"table_lessen_resultaat_tabel\");\r\n\r\n    let checksDiv = document.createElement(\"div\");\r\n    checksDiv.id = \"checksDiv\";\r\n    checksDiv.classList.add(\"badge-warning\");\r\n\r\n    let checksText = \"\";\r\n    table.parentNode.insertBefore(checksDiv, table.previousSibling);\r\n    for(let les of lessen) {\r\n        if (les.alc) {\r\n            if(les.visible) {\r\n                checksText += `<div>ALC les <b>${les.naam}</b> is online zichtbaar.</div>`;\r\n            }\r\n        }\r\n    }\r\n    checksDiv.innerHTML = checksText;\r\n}\r\n\r\nfunction showOnlyFullTrimesters(onlyFull: boolean) {\r\n    let trimDiv = document.getElementById(def.TRIM_DIV_ID);\r\n    trimDiv.dataset.showFullClass = onlyFull ? \"true\" : \"false\";\r\n}\r\n\r\nfunction onClickFullClasses() {\r\n    let lessen = scrapeLessenOverzicht();\r\n    let overzichtDiv = document.getElementById(def.LESSEN_OVERZICHT_ID);\r\n    overzichtDiv.dataset.filterFullClasses = (overzichtDiv.dataset.filterFullClasses?? \"false\") === \"false\" ? \"true\" : \"false\";\r\n    let displayState = overzichtDiv.dataset.filterFullClasses === \"true\" ? \"none\" : \"table-row\";\r\n    for(let les of lessen) {\r\n        if (les.aantal < les.maxAantal) {\r\n            les.tableRow.style.display = displayState;\r\n        }\r\n    }\r\n    setButtonHighlighted(def.FULL_CLASS_BUTTON_ID, overzichtDiv.dataset.filterFullClasses === \"true\");\r\n    showOnlyFullTrimesters(displayState === \"none\");\r\n}\r\n\r\nfunction onClickShowTrimesters() {\r\n    showTrimesterTable(document.getElementById(\"table_lessen_resultaat_tabel\").style.display !== \"none\");\r\n}\r\n\r\nfunction showTrimesterTable(show: boolean) {\r\n    //Build lazily and only once. Table will automatically be erased when filters are changed.\r\n    if (!document.getElementById(def.TRIM_TABLE_ID)) {\r\n        let inputModules = scrapeModules();\r\n        let tableData = buildTableData(inputModules);\r\n        buildTrimesterTable(tableData.instruments);\r\n    }\r\n\r\n    document.getElementById(\"table_lessen_resultaat_tabel\").style.display = show ? \"none\" : \"table\";\r\n    document.getElementById(def.TRIM_TABLE_ID).style.display = show ? \"table\" : \"none\";\r\n    document.getElementById(def.TRIM_BUTTON_ID).title = show ? \"Toon normaal\" : \"Toon trimesters\";\r\n    setButtonHighlighted(def.TRIM_BUTTON_ID, show);\r\n}\r\n\r\n", "import {HashObserver} from \"../pageObserver.js\";\r\n\r\nexport default new HashObserver(\"#lessen-les\", onMutation);\r\n\r\nfunction onMutation(mutation: MutationRecord) {\r\n    let tabLeerlingen = document.getElementById(\"les_leerlingen_leerlingen\");\r\n    if (mutation.target === tabLeerlingen) {\r\n        onLeerlingenChanged();\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction onLeerlingenChanged() {\r\n    console.log(\"Les-Leerlingen changed.\")\r\n    addSortVoornaamLink();\r\n}\r\n\r\nfunction addSortVoornaamLink() {\r\n    try {\r\n        let headerSpans = document.querySelectorAll(\"#les_leerlingen_leerlingen > span\");\r\n        let sortSpan = Array.from(headerSpans).find((value: HTMLSpanElement) => value.textContent.includes(\"gesorteerd op:\"));\r\n        let graadEnNaam = Array.from(sortSpan.querySelectorAll(\"a\")).find(anchor => anchor.textContent === \"graad en naam\");\r\n        const SORT_VOORNAAM_ID = \"dko_plugin_sortVoornaam\";\r\n        if(document.getElementById(SORT_VOORNAAM_ID))\r\n            return;\r\n        let anchorSortVoornaam = document.createElement(\"a\");\r\n        anchorSortVoornaam.id = SORT_VOORNAAM_ID;\r\n        anchorSortVoornaam.href = \"#\";\r\n        anchorSortVoornaam.innerText = \"voornaam\";\r\n        anchorSortVoornaam.classList.add(\"text-muted\");\r\n        anchorSortVoornaam.onclick = onSortVoornaam;\r\n        sortSpan.insertBefore(anchorSortVoornaam, graadEnNaam);\r\n        sortSpan.insertBefore(document.createTextNode(\" | \"), graadEnNaam);\r\n    }\r\n    catch (e) {}\r\n}\r\n\r\nfunction onSortVoornaam(event: MouseEvent) {\r\n    sortVoornaam(event);\r\n    switchNaamVoornaam(event);\r\n    return false;\r\n}\r\n\r\nfunction sortVoornaam(event: MouseEvent) {\r\n    let rows: HTMLTableRowElement[] = Array.from(document.querySelectorAll(\"#les_leerlingen_leerlingen > table > tbody > tr\"));\r\n\r\n    rows.sort((tr1, tr2) => {\r\n        let name1 = tr1.querySelector(\"td > strong\").textContent;\r\n        let name2 = tr2.querySelector(\"td > strong\").textContent;\r\n        let voornaam1 = name1.split(\",\").pop();\r\n        let voornaam2 = name2.split(\",\").pop();\r\n        return voornaam1.localeCompare(voornaam2);\r\n    });\r\n\r\n    let table: HTMLTableElement = document.querySelector(\"#les_leerlingen_leerlingen > table\");\r\n    rows.forEach(row => table.tBodies[0].appendChild(row));\r\n\r\n    Array.from(document.querySelectorAll(\"#les_leerlingen_leerlingen > span > a\"))\r\n        .forEach((a) => a.classList.add(\"text-muted\"));\r\n    (event.target as HTMLElement).classList.remove(\"text-muted\");\r\n}\r\n\r\nfunction switchNaamVoornaam(event: MouseEvent) {\r\n    let rows: HTMLTableRowElement[] = Array.from(document.querySelectorAll(\"#les_leerlingen_leerlingen > table > tbody > tr\"));\r\n\r\n    rows.forEach((tr) => {\r\n        let strong = tr.querySelector(\"td > strong\");\r\n        let name = strong.textContent;\r\n        let split = name.split(\",\");\r\n        let voornaam = split.pop() ?? \"\";\r\n        let naam = split.pop() ?? \"\";\r\n        strong.textContent = voornaam + \" \" + naam;\r\n    });\r\n}\r\n", "import {db3, getUserAndSchoolName, options} from \"../globals.js\";\r\nimport {PageObserver} from \"../pageObserver.js\";\r\n\r\nexport default new PageObserver(setSchoolBackground);\r\n\r\nfunction setSchoolBackground () {\r\n    let {userName, schoolName} = getUserAndSchoolName();\r\n    let isMyAcademy = options.otherAcademies\r\n        .split(\"\\n\")\r\n        .filter((needle) => needle !== \"\")\r\n        .find((needle) =>  schoolName.includes(needle)) != undefined;\r\n    if (options.otherAcademies === \"\") { //TODO: rename to myAcademies !!\r\n        isMyAcademy = true;\r\n    }\r\n    if (isMyAcademy) {\r\n        document.body.classList.remove(\"otherSchool\");\r\n    } else {\r\n        document.body.classList.add(\"otherSchool\");\r\n    }\r\n}", "import * as def from \"../def.js\";\r\nimport {createValidId, getSchoolIdString, getSchooljaar} from \"../globals.js\";\r\nimport {VakLeraar} from \"./scrapeUren.js\";\r\nimport {TableDef} from \"../table/tableDef.js\";\r\n\r\nlet isUpdatePaused = true;\r\nlet cellChanged = false;\r\nlet popoverIndex = 1;\r\n\r\nlet theData: TheData;\r\n\r\nlet editableObserver = new MutationObserver((mutationList, observer) => editableObserverCallback(mutationList, observer));\r\nsetInterval(checkAndUpdate, 5000);\r\n\r\ninterface ColDef {\r\n    label: string,\r\n    classList: string[],\r\n    factor: number,\r\n    getText?: (ctx: Context) => string,\r\n    getValue?: (ctx: Context) => number,\r\n    totals?: boolean,\r\n    calculated?: boolean,\r\n    fill?:(ctx: Context) => (number|undefined),\r\n    colIndex?: number,\r\n    total?: number\r\n}\r\n\r\nlet colDefsArray: {key: string, def: ColDef}[] = [\r\n    {key:\"uren_23_24\", def: { label:\"Uren\\n23-24\", classList: [\"editable_number\"], factor: 1.0, getValue: (ctx) => parseInt(ctx.data.fromCloud.columnMap.get(\"uren_23_24\")?.get(ctx.vakLeraar.id)), totals:true}},\r\n    {key:\"uren_24_25\", def: { label:\"Uren\\n24-25\", classList: [\"editable_number\"], factor: 1.0, getValue: (ctx) => parseInt(ctx.data.fromCloud.columnMap.get(\"uren_24_25\")?.get(ctx.vakLeraar.id)), totals:true}},\r\n    {key:\"vak\", def: { label:\"Vak\", classList: [], factor: 1.0, getText: (ctx) => ctx.vakLeraar.vak}},\r\n    {key:\"leraar\", def: { label:\"Leraar\", classList: [], factor: 1.0, getText: (ctx) => ctx.vakLeraar.leraar.replaceAll(\"{\", \"\").replaceAll(\"}\", \"\")}},\r\n    {key:\"grjr2_1\", def: { label:\"2.1\", classList: [], factor: 1/4, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n    {key:\"grjr2_2\", def: { label:\"2.2\", classList: [], factor: 1/4, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n    {key:\"grjr2_3\", def: { label:\"2.3\", classList: [], factor: 1/3, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n    {key:\"grjr2_4\", def: { label:\"2.4\", classList: [], factor: 1/3, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n\r\n    {key:\"uren_2e_gr\", def: { label:\"uren\\n2e gr\", classList: [\"yellow\"], factor: 1.0, getValue: (ctx) => calcUrenFactored(ctx, [\"grjr2_1\", \"grjr2_2\", \"grjr2_3\", \"grjr2_4\"]), totals:true, calculated:true}},\r\n\r\n    {key:\"grjr3_1\", def: { label:\"3.1\", classList: [], factor: 1/3, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n    {key:\"grjr3_2\", def: { label:\"3.2\", classList: [], factor: 1/3, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n    {key:\"grjr3_3\", def: { label:\"3.3\", classList: [], factor: 1/2, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n\r\n    {key:\"uren_3e_gr\", def: { label:\"uren\\n3e gr\", classList: [\"yellow\"], factor: 1.0, getValue: (ctx) => calcUrenFactored(ctx, [\"grjr3_1\", \"grjr3_2\", \"grjr3_3\"]), totals:true, calculated:true}},\r\n\r\n    {key:\"grjr4_1\", def: { label:\"4.1\", classList: [], factor: 1/2, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n    {key:\"grjr4_2\", def: { label:\"4.2\", classList: [], factor: 1/2, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n    {key:\"grjr4_3\", def: { label:\"4.3\", classList: [], factor: 1/2, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n\r\n    {key:\"uren_4e_gr\", def: { label:\"uren\\n4e gr\", classList: [\"yellow\"], factor: 1.0, getValue: (ctx) => calcUrenFactored(ctx, [\"grjr4_1\", \"grjr4_2\", \"grjr4_3\"]), totals:true, calculated:true}},\r\n\r\n    {key:\"grjr_s_1\", def: { label:\"S.1\", classList: [], factor: 1/2, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n    {key:\"grjr_s_2\", def: { label:\"S.2\", classList: [], factor: 1/2, getValue: (ctx) => ctx.vakLeraar.countMap.get(ctx.colDef.label).count, fill: fillGraadCell }},\r\n\r\n    {key:\"uren_spec\", def: { label:\"uren\\nspec\", classList: [\"yellow\"], factor: 1.0, getValue: (ctx) => calcUrenFactored(ctx, [\"grjr_s_1\", \"grjr_s_2\"]), totals:true, calculated:true}},\r\n\r\n    {key:\"aantal_lln\", def: { label:\"aantal\\nlln\", classList: [\"blueish\"], factor: 1.0, getValue: (ctx) => calcUren(ctx, [\"grjr2_1\", \"grjr2_2\", \"grjr2_3\", \"grjr2_4\", \"grjr3_1\", \"grjr3_2\", \"grjr3_3\", \"grjr4_1\", \"grjr4_2\", \"grjr4_3\", \"grjr_s_1\", \"grjr_s_2\"]), totals:true, calculated:true}},\r\n    {key:\"tot_uren\", def: { label:\"tot\\nuren\", classList: [\"creme\"], factor: 1.0, getValue: (ctx) => calcUrenFactored(ctx, [\"grjr2_1\", \"grjr2_2\", \"grjr2_3\", \"grjr2_4\", \"grjr3_1\", \"grjr3_2\", \"grjr3_3\", \"grjr4_1\", \"grjr4_2\", \"grjr4_3\", \"grjr_s_1\", \"grjr_s_2\"]), totals:true, calculated:true}},\r\n    {key:\"over\", def: { label:\"Over\", classList: [], factor: 1.0, getValue: (ctx) => calcOver(ctx), calculated:true}},\r\n];\r\n\r\ncolDefsArray.forEach((colDef, index) => {\r\n    colDef.def.colIndex = index;\r\n    colDef.def.total = 0;\r\n});\r\nlet colDefs = new Map(colDefsArray.map((def) => [def.key, def.def]));\r\n\r\nfunction calcOver(ctx: Context) {\r\n    let totUren = getColValue(ctx, \"tot_uren\");\r\n    if (isNaN(totUren)) {\r\n        totUren = 0;\r\n\r\n    }\r\n    let urenJaar = getColValue(ctx, \"uren_24_25\");\r\n    if (isNaN(urenJaar)) {\r\n        urenJaar = 0;\r\n    }\r\n    return urenJaar - totUren;\r\n\r\n}\r\n\r\ninterface Context {\r\n    vakLeraar: VakLeraar;\r\n    colKey: string;\r\n    tr: HTMLTableRowElement,\r\n    td: HTMLTableCellElement,\r\n    colDef: ColDef,\r\n    colDefs: Map<string, ColDef>,\r\n    data: TheData\r\n}\r\n\r\nfunction getColValue(ctx: Context, colKey: string) {\r\n\r\n    let newCtx: Context = {...ctx};\r\n    newCtx.colKey = colKey;\r\n\r\n    newCtx.colDef = newCtx.colDefs.get(colKey);\r\n    return newCtx.colDef.getValue(newCtx);\r\n}\r\n\r\nfunction editableObserverCallback(mutationList: MutationRecord[], _observer: MutationObserver) {\r\n    if (mutationList.every((mut) => mut.type === \"attributes\"))\r\n        return; //ignore attrubute changes.\r\n    cellChanged = true;\r\n}\r\n\r\nexport function getUrenVakLeraarFileName() {\r\n\r\n    return getSchoolIdString() + \"_\" + \"uren_vak_lk_\" + getSchooljaar().replace(\"-\", \"_\") + \".json\";\r\n}\r\n\r\nexport interface JsonCloudData {\r\n    columnMap?: Map<string, Map<string, string>>;\r\n    version: string,\r\n    columns: JsonColumn[]\r\n}\r\n\r\ninterface JsonColumn {\r\n    key: string,\r\n    rows: JsonCell[]\r\n    rowMap?: Map<string, string>;\r\n}\r\n\r\nfunction buildJsonData() {\r\n    let data: JsonCloudData = {\r\n        version: \"1.0\",\r\n        columns: []\r\n    };\r\n    let col1 = columnToJson(data, \"uren_23_24\");\r\n    let col2 = columnToJson(data, \"uren_24_25\");\r\n    data.columns.push({key: \"uren_23_24\", rows: col1});\r\n    data.columns.push({key: \"uren_24_25\", rows: col2});\r\n    return data;\r\n}\r\n\r\ninterface JsonCell {\r\n    key: string,\r\n    value: string\r\n}\r\n\r\nfunction columnToJson(_data: JsonCloudData, colKey: string) {\r\n    let cells: JsonCell[] = [];\r\n    for (let [key, value] of theData.fromCloud.columnMap.get(colKey)) {\r\n        let row: JsonCell = {\r\n            key: key,\r\n            value: value\r\n        };\r\n        cells.push(row);\r\n    }\r\n    return cells;\r\n}\r\n\r\nfunction checkAndUpdate() {\r\n    if(isUpdatePaused) {\r\n        return;\r\n    }\r\n    if(!cellChanged) {\r\n        return;\r\n    }\r\n    let fileName = getUrenVakLeraarFileName();\r\n    cellChanged = false;\r\n    updateColumnData( \"uren_23_24\");\r\n    updateColumnData( \"uren_24_25\");\r\n    let data = buildJsonData();\r\n\r\n    // uploadData(fileName, data);\r\n    mapCloudData(data);//TODO: separate stages of data: raw data from/to cloud or from/to scraping, preparing the data, displaying the data.\r\n    theData.fromCloud = data;\r\n\r\n    recalculate();\r\n}\r\n\r\nfunction updateColumnData(colKey: string) {\r\n    let colDef = colDefs.get(colKey);\r\n    for(let tr of document.querySelectorAll(\"#\"+def.COUNT_TABLE_ID+\" tbody tr\")) {\r\n        theData.fromCloud.columnMap.get(colKey).set(tr.id, tr.children[colDef.colIndex].textContent);\r\n    }\r\n}\r\n\r\nfunction observeTable(observe: boolean) {\r\n    const config = {\r\n        attributes: true,\r\n        childList: true,\r\n        subtree: true,\r\n        characterData: true\r\n    };\r\n    let table = document.getElementById(def.COUNT_TABLE_ID);\r\n    if(observe) {\r\n        editableObserver.takeRecords(); //clear\r\n        editableObserver.observe(table, config);\r\n    } else {\r\n        editableObserver.disconnect();\r\n    }\r\n}\r\n\r\nfunction mapCloudData(fromCloud: JsonCloudData) {\r\n    for (let column of fromCloud.columns) {\r\n        column.rowMap = new Map(column.rows.map((row) => [row.key, row.value]));\r\n    }\r\n    fromCloud.columnMap = new Map(fromCloud.columns.map((col) => [col.key, col.rowMap]));\r\n}\r\n\r\nfunction fillCell(ctx: Context): (number| undefined) {\r\n    if(ctx.colDef.getText) {\r\n        ctx.td.innerText = ctx.colDef.getText(ctx);\r\n        return undefined;\r\n    }\r\n    if (ctx.colDef.fill) {\r\n        ctx.colDef.fill(ctx);\r\n        return undefined;\r\n    }\r\n    let theValue = ctx.colDef.getValue(ctx);\r\n    ctx.td.innerText = trimNumber(theValue);\r\n    return theValue;\r\n}\r\n\r\nfunction calculateAndSumCell(colDef: ColDef, ctx: Context, onlyRecalc: boolean) {\r\n    let theValue = undefined;\r\n    if (colDef.calculated || !onlyRecalc)\r\n        theValue = fillCell(ctx);\r\n    if (colDef.totals) {\r\n        if (!theValue)\r\n            theValue = colDef.getValue(ctx); //get value when not a calculated value.\r\n        if (theValue)\r\n            colDef.total += theValue;\r\n    }\r\n}\r\n\r\nfunction clearTotals() {\r\n    for (let [_colKey, colDef] of colDefs) {\r\n        if (colDef.totals) {\r\n            colDef.total = 0;\r\n        }\r\n    }\r\n}\r\n\r\nfunction recalculate() {\r\n    isUpdatePaused = true;\r\n    observeTable(false);\r\n    clearTotals();\r\n\r\n    for (let [vakLeraarKey, vakLeraar] of theData.vakLeraars) {\r\n        let tr = document.getElementById(createValidId(vakLeraarKey)) as HTMLTableRowElement;\r\n        for(let [colKey, colDef] of colDefs) {\r\n            let td = tr.children[colDef.colIndex] as HTMLTableCellElement;\r\n            let ctx: Context = {td, colKey, colDef, vakLeraar, tr, colDefs, data: theData};\r\n            calculateAndSumCell(colDef, ctx, true);\r\n        }\r\n    }\r\n    let trTotal = document.getElementById(\"__totals__\");\r\n    for(let [_colKey, colDef] of colDefs) {\r\n        let td = trTotal.children[colDef.colIndex] as HTMLTableCellElement;\r\n        if(colDef.totals) {\r\n            td.innerText = trimNumber(colDef.total);\r\n        }\r\n    }\r\n\r\n    cellChanged = false;\r\n    isUpdatePaused = false;\r\n    observeTable(true);\r\n}\r\n\r\nexport interface TheData {\r\n    fromCloud: JsonCloudData,\r\n    vakLeraars: Map<string, VakLeraar>\r\n}\r\n\r\nexport function buildTable(data: TheData, tableDef: TableDef) {\r\n    isUpdatePaused = true;\r\n    theData = data;\r\n    let table = document.createElement(\"table\");\r\n    tableDef.tableRef.getOrgTable().insertAdjacentElement(\"afterend\", table);\r\n    table.id = def.COUNT_TABLE_ID;\r\n    table.classList.add(\"canSort\");\r\n    fillTableHeader(table, data.vakLeraars);\r\n    let tbody = document.createElement(\"tbody\");\r\n    table.appendChild(tbody);\r\n    mapCloudData(data.fromCloud);\r\n\r\n    let lastVak = \"\";\r\n    let rowClass = undefined;\r\n    clearTotals();\r\n\r\n    for(let [vakLeraarKey, vakLeraar] of data.vakLeraars) {\r\n        let tr = document.createElement(\"tr\");\r\n        tbody.appendChild(tr);\r\n        tr.dataset[\"vak_leraar\"] = vakLeraarKey;\r\n        tr.id = createValidId(vakLeraarKey);\r\n        if(vakLeraar.vak !== lastVak) {\r\n            rowClass = (rowClass === \"\"? \"darkRow\" : \"\");\r\n        }\r\n        if(rowClass !== \"\")\r\n            tr.classList.add(rowClass);\r\n        lastVak = vakLeraar.vak;\r\n        for(let [colKey, colDef] of colDefs) {\r\n            let td = document.createElement(\"td\");\r\n            tr.appendChild(td);\r\n            td.classList.add(...colDef.classList);\r\n            let ctx = {td, colKey, colDef, vakLeraar, tr, colDefs, data};\r\n            calculateAndSumCell(colDef, ctx, false);\r\n        }\r\n    }\r\n    let tFoot = document.createElement(\"tfoot\");\r\n    table.appendChild(tFoot);\r\n    tFoot.classList.add(\"separatorLine\");\r\n    let trTotal = document.createElement(\"tr\");\r\n    tFoot.appendChild(trTotal);\r\n    \r\n    trTotal.id = \"__totals__\";\r\n    for(let [_colKey, colDef] of colDefs) {\r\n        let td = document.createElement(\"td\") as HTMLTableCellElement;\r\n        trTotal.appendChild(td);\r\n        if(colDef.totals) {\r\n            td.innerText = trimNumber(colDef.total);\r\n        }\r\n    }\r\n\r\n    let editables = table.querySelectorAll(\"td.editable_number\");\r\n    editables.forEach((td) => td.setAttribute(\"contenteditable\", \"true\"));\r\n    observeTable(true);\r\n    isUpdatePaused = false;\r\n}\r\n\r\nfunction calcUren(ctx: Context, keys: string[]) {\r\n    let tot = 0;\r\n    for(let key of keys) {\r\n        let colDef = ctx.colDefs.get(key);\r\n        let cnt = ctx.vakLeraar.countMap.get(colDef.label).students.length;\r\n        tot += cnt;\r\n    }\r\n    return tot;\r\n}\r\n\r\nfunction calcUrenFactored(ctx: Context, keys: string[]) {\r\n    let tot = 0;\r\n    for(let key of keys) {\r\n        let colDef = ctx.colDefs.get(key);\r\n        let cnt = ctx.vakLeraar.countMap.get(colDef.label).students.length;\r\n        let factor = colDefs.get(key).factor;\r\n        tot += cnt * factor;\r\n    }\r\n    return tot;\r\n}\r\n\r\nfunction trimNumber(num: number) {\r\n    if(isNaN(num))\r\n        return \"\";\r\n    // @ts-ignore `num` is checked too be number\r\n    return (Math.round(num * 100) / 100).toFixed(2).replace(\".00\", \"\");\r\n}\r\n\r\nfunction fillTableHeader(table: HTMLTableElement, _vakLeraars: Map<string, VakLeraar>) {\r\n    let thead = document.createElement(\"thead\");\r\n    table.appendChild(thead);\r\n    let tr_head = document.createElement(\"tr\");\r\n    thead.appendChild(tr_head);\r\n    let th = document.createElement(\"th\");\r\n    for (let colDef of colDefs.values()) {\r\n        th = document.createElement(\"th\");\r\n        tr_head.appendChild(th);\r\n        th.innerText = colDef.label;\r\n    }\r\n}\r\n\r\nfunction fillGraadCell(ctx: Context) {\r\n    let graadJaar = ctx.vakLeraar.countMap.get(ctx.colDef.label);\r\n    let button = document.createElement(\"button\") as HTMLButtonElement;\r\n    ctx.td.appendChild(button);\r\n    if(graadJaar.count === 0)\r\n        return graadJaar.count;\r\n    button.innerText = graadJaar.count.toString();\r\n    popoverIndex++;\r\n    button.setAttribute(\"popovertarget\", \"students_\" + popoverIndex);\r\n    let popoverDiv = document.createElement(\"div\");\r\n    ctx.td.appendChild(popoverDiv);\r\n    popoverDiv.id = \"students_\" + popoverIndex;\r\n    popoverDiv.setAttribute(\"popover\", \"auto\");\r\n    for (let student of graadJaar.students) {\r\n        let studentDiv = document.createElement(\"div\");\r\n        popoverDiv.appendChild(studentDiv);\r\n        studentDiv.innerText = student.voornaam + \" \" + student.naam;\r\n        const anchor = document.createElement(\"a\");\r\n        studentDiv.appendChild(anchor);\r\n        anchor.href = \"/?#leerlingen-leerling?id=\" + student.id + \",tab=inschrijvingen\";\r\n        anchor.classList.add(\"pl-1\");\r\n        anchor.dataset.studentid = student.id.toString();\r\n\r\n        const iTag = document.createElement(\"i\");\r\n        anchor.appendChild(iTag);\r\n        iTag.classList.add('fas', \"fa-user-alt\");\r\n    }\r\n    return graadJaar.count;\r\n}\r\n", "import {createValidId} from \"../globals.js\";\r\nimport {TableDef} from \"../table/tableDef.js\";\r\nimport {NamedCellPageHandler} from \"../pageHandlers.js\";\r\nimport {StudentInfo} from \"../lessen/scrape.js\";\r\n\r\nexport interface CountStudentsPerJaar {\r\n    count: number,\r\n    students: StudentInfo[]\r\n}\r\nexport interface VakLeraar {\r\n    vak: string,\r\n    leraar: string,\r\n    id: string,\r\n    countMap: Map<string, CountStudentsPerJaar>\r\n}\r\n\r\nexport function scrapeStudent(tableDef: TableDef, tr: HTMLTableRowElement, collection: any) {\r\n    let student: StudentInfo = new StudentInfo();\r\n    student.naam = (tableDef.pageHandler as NamedCellPageHandler).getColumnText(tr, \"naam\");\r\n    student.voornaam = (tableDef.pageHandler as NamedCellPageHandler).getColumnText(tr,\"voornaam\");\r\n    student.id = parseInt(tr.attributes['onclick'].value.replace(\"showView('leerlingen-leerling', '', 'id=\", \"\"));\r\n    let leraar = (tableDef.pageHandler as NamedCellPageHandler).getColumnText(tr,\"klasleerkracht\");\r\n    let vak = (tableDef.pageHandler as NamedCellPageHandler).getColumnText(tr,\"vak\");\r\n    let graadLeerjaar = (tableDef.pageHandler as NamedCellPageHandler).getColumnText(tr,\"graad + leerjaar\");\r\n\r\n    if (leraar === \"\") leraar = \"{nieuw}\";\r\n\r\n    if (!isInstrument(vak)) {\r\n        console.error(\"vak is geen instrument!!!\");\r\n        return false;\r\n    }\r\n    let vakLeraarKey = translateVak(vak) + \"_\" + leraar;\r\n\r\n    if (!collection.has(vakLeraarKey)) {\r\n        let countMap: Map<string, CountStudentsPerJaar> = new Map();\r\n        countMap.set(\"2.1\", {count: 0, students: []});\r\n        countMap.set(\"2.2\", {count: 0, students: []});\r\n        countMap.set(\"2.3\", {count: 0, students: []});\r\n        countMap.set(\"2.4\", {count: 0, students: []});\r\n        countMap.set(\"3.1\", {count: 0, students: []});\r\n        countMap.set(\"3.2\", {count: 0, students: []});\r\n        countMap.set(\"3.3\", {count: 0, students: []});\r\n        countMap.set(\"4.1\", {count: 0, students: []});\r\n        countMap.set(\"4.2\", {count: 0, students: []});\r\n        countMap.set(\"4.3\", {count: 0, students: []});\r\n        countMap.set(\"S.1\", {count: 0, students: []});\r\n        countMap.set(\"S.2\", {count: 0, students: []});\r\n        let vakLeraarObject = {\r\n            vak: translateVak(vak),\r\n            leraar: leraar,\r\n            id: createValidId(vakLeraarKey),\r\n            countMap: countMap\r\n        };\r\n        collection.set(vakLeraarKey, vakLeraarObject);\r\n    }\r\n    let vakLeraar = collection.get(vakLeraarKey);\r\n    if (!vakLeraar.countMap.has(graadLeerjaar)) {\r\n        vakLeraar.countMap.set(graadLeerjaar, {count: 0, students: []});\r\n    }\r\n    let graadLeraarObject = collection.get(vakLeraarKey).countMap.get(graadLeerjaar);\r\n    graadLeraarObject.count += 1;\r\n    graadLeraarObject.students.push(student);\r\n    return true;\r\n}\r\n\r\nfunction isInstrument(vak: string) {\r\n    switch (vak) {\r\n        case \"Muziekatelier\": \r\n        case \"Groepsmusiceren (jazz pop rock)\": \r\n        case \"Groepsmusiceren (klassiek)\": \r\n        case \"Harmonielab\": \r\n        case \"Instrumentinitiatie - elke trimester een ander instrument\": \r\n        case \"instrumentinitiatie \u2013 piano het hele jaar\": \r\n        case \"Klanklab elektronische muziek\": \r\n        case \"Muziektheorie\": \r\n        case \"Koor (jazz pop rock)\": \r\n        case \"Koor (musical)\": \r\n        case \"Arrangeren\": \r\n        case \"Groepsmusiceren (opera)\": \r\n            return false;\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction translateVak(vak: string) {\r\n    function renameInstrument(instrument: string) {\r\n        return instrument\r\n            .replace(\"Basklarinet\", \"Klarinet\")\r\n            .replace(\"Altfluit\", \"Dwarsfluit\")\r\n            .replace(\"Piccolo\", \"Dwarsfluit\")\r\n\r\n            .replace(\"Trompet\", \"Koper\") //keept this one on top because of the next line!\r\n            .replace(\"Koper (jazz pop rock)\", \"Trompet (jazz pop rock)\")\r\n            .replace(\"Hoorn\", \"Koper\")\r\n            .replace(\"Trombone\", \"Koper\")\r\n            .replace(\"Bugel\", \"Koper\")\r\n            .replace(\"Eufonium\", \"Koper\")\r\n\r\n            .replace(\"Altsaxofoon\", \"Saxofoon\")\r\n            .replace(\"Sopraansaxofoon\", \"Saxofoon\")\r\n            .replace(\"Tenorsaxofoon\", \"Saxofoon\");\r\n    }\r\n\r\n    if(vak.includes(\"(jazz pop rock)\")) {\r\n        return \"JPR \" + renameInstrument(vak).replace(\"(jazz pop rock)\", \"\");\r\n    }\r\n    if(vak.includes(\"musical\")) {\r\n        return \"M \" + renameInstrument(vak).replace(\"(musical)\", \"\");\r\n    }\r\n    if(vak.includes(\"wereldmuziek\")) {\r\n        return \"WM \" + renameInstrument(vak).replace(\"(wereldmuziek)\", \"\");\r\n    }\r\n\r\n\r\n    return \"K \" + renameInstrument(vak);\r\n}", "import * as def from \"./def.js\";\r\n\r\nexport async function fetchFromCloud(fileName: string) {\r\n    return fetch(def.JSON_URL + \"?fileName=\"+fileName, {method: \"GET\"})\r\n        .then((res) => res.json());\r\n}\r\n\r\nexport function uploadData(fileName: string, data: any) {\r\n    fetch(def.JSON_URL + \"?fileName=\"+fileName, {\r\n        method: \"POST\",\r\n        body: JSON.stringify(data)\r\n    })\r\n        .then((res) => res.text().then((text) => {\r\n            console.log(text);\r\n        }));\r\n}", "export class TableNavigation {\r\n    readonly step: number;\r\n    private readonly maxCount: number;\r\n    private div: HTMLDivElement;\r\n\r\n    constructor(step: number, maxCount: number, div: HTMLDivElement/*, navigationData: any*/) {\r\n        this.step = step;\r\n        this.maxCount = maxCount;\r\n        this.div = div;\r\n    }\r\n\r\n    steps() {\r\n        return Math.ceil(this.maxCount / this.step)\r\n    }\r\n\r\n    isOnePage() {\r\n        return this.step >= this.maxCount;\r\n    }\r\n}\r\n\r\n/* possible ranges of numbers found:\r\n[1, 100, 100, 500, 580] -> interval is [1] = 100\r\n[0, 400, 501, 580, 580]  -> interval is [1] -> [2]-1 = 100\r\n[0, 200, 301, 400, 400, 500, 580] -> interval is [1] -> [2]\r\n*/\r\nexport function findFirstNavigation() {\r\n    //get all possible numbers from the navigation bar and sort them to get the result above.\r\n    let buttonPagination = document.querySelector(\"button.datatable-paging-numbers\") as HTMLButtonElement;\r\n    if(!buttonPagination)\r\n        return undefined;\r\n    let buttonContainer = buttonPagination.closest(\"div\") as HTMLDivElement;\r\n    if(!buttonContainer) {\r\n        return undefined;\r\n    }\r\n    let rx = /(\\d*) tot (\\d*) van (\\d*)/;\r\n    let matches = buttonPagination.innerText.match(rx);\r\n    let buttons = buttonContainer.querySelectorAll(\"button.btn-secondary\");\r\n    let numbers = Array.from(buttons)\r\n        .filter((btn) => btn.attributes[\"onclick\"]?.value.includes(\"goto(\"))\r\n        .map((btn) => btn.attributes[\"onclick\"].value)\r\n        .map((txt) => getGotoNumber(txt));\r\n    matches.slice(1).forEach((txt) => numbers.push(parseInt(txt)));\r\n    numbers.sort((a, b) => a - b);\r\n    if (numbers[0] === 1) {\r\n        return new TableNavigation(numbers[1], numbers.pop(), buttonContainer);\r\n    } else {\r\n        return new TableNavigation(numbers[2] - numbers[1] - 1, numbers.pop(), buttonContainer);\r\n    }\r\n}\r\n\r\nfunction getGotoNumber(functionCall: string) {\r\n    return parseInt(functionCall.substring(functionCall.indexOf(\"goto(\") + 5));\r\n}", "import * as def from \"./def.js\";\r\n\r\nexport class ProgressBar {\r\n    private barElement: HTMLElement;\r\n    private containerElement: HTMLElement;\r\n    private readonly maxCount: number;\r\n    private count: number;\r\n\r\n    constructor(containerElement: HTMLElement, barElement: HTMLElement, maxCount: number) {\r\n        this.barElement = barElement;\r\n        this.containerElement = containerElement;\r\n        this.maxCount = maxCount;\r\n        this.count = 0;\r\n        for (let i = 0; i < maxCount; i++) {\r\n            let block = document.createElement(\"div\");\r\n            barElement.appendChild(block);\r\n            block.classList.add(\"progressBlock\");\r\n        }\r\n    }\r\n\r\n    start() {\r\n        this.containerElement.style.visibility = \"visible\";\r\n        this.next();\r\n    }\r\n\r\n    stop() {\r\n        this.containerElement.style.visibility = \"hidden\";\r\n    }\r\n\r\n    next() {\r\n        if (this.count >= this.maxCount)\r\n            return false;\r\n        this.barElement.children[this.count].classList.remove(\"iddle\", \"loaded\");\r\n        this.barElement.children[this.count].classList.add(\"loading\");\r\n        for (let i = 0; i < this.count; i++) {\r\n            this.barElement.children[i].classList.remove(\"iddle\", \"loading\");\r\n            this.barElement.children[i].classList.add(\"loaded\");\r\n        }\r\n        for (let i = this.count + 1; i < this.maxCount; i++) {\r\n            this.barElement.children[i].classList.remove(\"loaded\", \"loading\");\r\n            this.barElement.children[i].classList.add(\"iddle\");\r\n        }\r\n        this.count++;\r\n        return true;\r\n    }\r\n}\r\n\r\nexport function insertProgressBar(container: HTMLElement, steps: number, text: string = \"\") {\r\n    let divProgressLine = document.getElementById(def.PROGRESS_BAR_ID);\r\n    if(divProgressLine) {\r\n        divProgressLine.innerText = \"\";\r\n    } else {\r\n        divProgressLine = document.createElement(\"div\");\r\n        container.append(divProgressLine);\r\n        divProgressLine.classList.add(\"infoLine\");\r\n        divProgressLine.id = def.PROGRESS_BAR_ID;\r\n    }\r\n    let divProgressText = document.createElement(\"div\");\r\n    divProgressLine.appendChild(divProgressText);\r\n    divProgressText.classList.add(\"progressText\");\r\n    divProgressText.innerText = text;\r\n    let divProgressBar = document.createElement(\"div\");\r\n    divProgressLine.appendChild(divProgressBar);\r\n    divProgressBar.classList.add(\"progressBar\");\r\n    return new ProgressBar(divProgressLine, divProgressBar, steps);\r\n}", "import {PageHandler} from \"../pageHandlers.js\";\r\nimport {findFirstNavigation, TableNavigation} from \"./tableNavigation.js\";\r\nimport {insertProgressBar, ProgressBar} from \"../progressBar.js\";\r\nimport * as def from \"../def.js\";\r\nimport {db3, millisToString} from \"../globals.js\";\r\n\r\nexport class TableRef {\r\n    tableId: string;\r\n    buildFetchUrl: (offset: number) => string;\r\n    navigationData: TableNavigation;\r\n\r\n    constructor(tableId: string, navigationData: TableNavigation, buildFetchUrl: (offset: number) => string) {\r\n        this.tableId = tableId;\r\n        this.buildFetchUrl = buildFetchUrl;\r\n        this.navigationData = navigationData;\r\n    }\r\n\r\n    getOrgTable() {\r\n        return document.getElementById(this.tableId) as HTMLTableElement;\r\n    }\r\n}\r\n\r\nexport function findTableRefInCode() {\r\n    let foundTableRef = findTable();\r\n    if(!foundTableRef)\r\n        return undefined;\r\n\r\n    let buildFetchUrl = (offset: number) => `/views/ui/datatable.php?id=${foundTableRef.viewId}&start=${offset}&aantal=0`;\r\n\r\n    let navigation = findFirstNavigation();\r\n    if(!navigation)\r\n        return undefined;\r\n\r\n    return new TableRef( foundTableRef.tableId, navigation, buildFetchUrl)\r\n}\r\n\r\nfunction findTable() {\r\n    let table = document.querySelector(\"div.table-responsive > table\");\r\n    if(!table)\r\n        debugger;\r\n    let tableId = table.id\r\n        .replace(\"table_\", \"\")\r\n        .replace(\"_table\", \"\");\r\n\r\n    let parentDiv = document.querySelector(\"div#\"+\"table_\"+tableId);\r\n    let scripts = Array.from(parentDiv.querySelectorAll(\"script\")).map((script) => script.text).join(\"\\n\");\r\n    let goto = scripts.split(\"_goto(\")[1];\r\n    let func = goto.split(/ function *\\w/)[0];\r\n\r\n    let viewId = / *datatable_id *= *'(.*)'/.exec(func)[1];\r\n    let url = /_table'\\).load\\('(.*?)\\?id='\\s*\\+\\s*datatable_id\\s*\\+\\s*'&start='\\s*\\+\\s*start/.exec(func)[1];\r\n    //if we got so far, we can be sure this table is a standard one.\r\n    return {\r\n        tableId: table.id,\r\n        viewId,\r\n        url\r\n    };\r\n}\r\n\r\nexport type CalculateTableCheckSumHandler = (tableDef: TableDef) => string;\r\n\r\nexport class TableDef {\r\n    tableRef: TableRef;\r\n    pageHandler: PageHandler;\r\n    parallelData = undefined;\r\n    calculateTableCheckSum: CalculateTableCheckSumHandler;\r\n    shadowTableTemplate: HTMLTemplateElement;\r\n    isUsingChached = false;\r\n    divInfoContainer: HTMLDivElement;\r\n    shadowTableDate: Date;\r\n    private tempMessage = \"\";\r\n\r\n    constructor(tableRef: TableRef, pageHandler: PageHandler, calculateTableCheckSum: CalculateTableCheckSumHandler) {\r\n        this.tableRef = tableRef;\r\n        this.pageHandler = pageHandler;\r\n        if(!calculateTableCheckSum)\r\n            throw (\"Tablechecksum required.\");\r\n        this.calculateTableCheckSum = calculateTableCheckSum;\r\n        this.setupInfoBar();\r\n    }\r\n\r\n    saveToCache() {\r\n        db3(`Caching ${this.getCacheId()}.`);\r\n        window.sessionStorage.setItem(this.getCacheId(), this.shadowTableTemplate.innerHTML);\r\n        window.sessionStorage.setItem(this.getCacheId()+ def.CACHE_DATE_SUFFIX, (new Date()).toJSON());\r\n    }\r\n\r\n    clearCache() {\r\n        db3(`Clear cache for ${this.tableRef.tableId}.`);\r\n        window.sessionStorage.removeItem(this.getCacheId());\r\n        window.sessionStorage.removeItem(this.getCacheId()+ def.CACHE_DATE_SUFFIX);\r\n    }\r\n\r\n    loadFromCache() {\r\n        if(this.tableRef.navigationData.isOnePage())\r\n            return null;\r\n\r\n        db3(`Loading from cache: ${this.getCacheId()}.`);\r\n        let text =  window.sessionStorage.getItem(this.getCacheId());\r\n        let dateString = window.sessionStorage.getItem(this.getCacheId() + def.CACHE_DATE_SUFFIX);\r\n        if(!text)\r\n            return undefined;\r\n        return {\r\n            text,\r\n            date: new Date(dateString)\r\n        };\r\n    }\r\n\r\n    getCacheId() {\r\n        let checksum = \"\";\r\n        if (this.calculateTableCheckSum)\r\n            checksum = \"__\" + this.calculateTableCheckSum(this);\r\n        let id = this.tableRef.tableId + checksum;\r\n        return id.replaceAll(/\\s/g, \"\");\r\n    }\r\n\r\n    setupInfoBar() {\r\n        this.divInfoContainer = document.createElement(\"div\");\r\n        this.tableRef.getOrgTable().insertAdjacentElement(\"beforebegin\", this.divInfoContainer);\r\n        this.divInfoContainer.classList.add(\"infoLine\");\r\n    }\r\n\r\n    clearInfoBar() {\r\n        this.divInfoContainer.innerHTML = \"\";\r\n    }\r\n\r\n    updateInfoBar() {\r\n        this.updateCacheInfo();\r\n        this.#updateTempMessage();\r\n        //...update other info...\r\n    }\r\n\r\n    setTempMessage(msg: string) {\r\n        this.tempMessage = msg;\r\n        this.#updateTempMessage();\r\n        setTimeout(this.clearTempMessage.bind(this), 4000);\r\n    }\r\n\r\n    clearTempMessage() {\r\n        this.tempMessage = \"\";\r\n        this.#updateTempMessage();\r\n    }\r\n\r\n    #updateTempMessage() {\r\n        let p = document.getElementById(def.TEMP_MSG_ID);\r\n        if(this.tempMessage === \"\") {\r\n            if(p) p.remove();\r\n            return;\r\n        }\r\n        if(!p) {\r\n            p = document.createElement(\"p\");\r\n            this.divInfoContainer.appendChild(p);\r\n            p.classList.add(\"tempMessage\");\r\n            p.id = def.TEMP_MSG_ID;\r\n        }\r\n        p.innerHTML = this.tempMessage;\r\n    }\r\n\r\n    clearCacheInfo() {\r\n        document.getElementById(def.CACHE_INFO_ID)?.remove();\r\n    }\r\n\r\n    updateCacheInfo() {\r\n        let p = document.getElementById(def.CACHE_INFO_ID);\r\n        if(!this.isUsingChached) {\r\n            if(p) p.remove();\r\n            return;\r\n        }\r\n\r\n        if(!p) {\r\n            p = document.createElement(\"p\");\r\n            this.divInfoContainer.appendChild(p);\r\n            p.classList.add(\"cacheInfo\");\r\n            p.id = def.CACHE_INFO_ID;\r\n        }\r\n        p.innerHTML = `Gegevens uit cache, ${millisToString((new Date()).getTime()-this.shadowTableDate.getTime())} oud. `;\r\n        let a = document.createElement(\"a\");\r\n        p.appendChild(a);\r\n        a.innerHTML = \"refresh\";\r\n        a.href=\"#\";\r\n        a.onclick = (e ) => {\r\n            e.preventDefault();\r\n            this.clearCache();\r\n            // noinspection JSIgnoredPromiseFromCall\r\n            this.getTableData();\r\n            return true;\r\n        }\r\n    }\r\n    async getTableData(rawData?: any, parallelAsyncFunction?: (() => Promise<any>)) {\r\n        this.clearCacheInfo();\r\n        let cachedData = this.loadFromCache();\r\n\r\n        if(cachedData) {\r\n            if(parallelAsyncFunction) {\r\n                this.parallelData = await parallelAsyncFunction();\r\n            }\r\n            this.shadowTableTemplate = document.createElement(\"template\");\r\n            this.shadowTableTemplate.innerHTML = cachedData.text;\r\n            this.shadowTableDate = cachedData.date;\r\n            this.isUsingChached = true;\r\n            db3(`${this.tableRef.tableId}: using cached data.`);\r\n            let rows = this.shadowTableTemplate.content.querySelectorAll(\"tbody > tr\") as NodeListOf<HTMLTableRowElement>;\r\n            //TODO: collection is set to undefined. This call to onPage(), should be EXACTLY the same as with a real fetch.\r\n            if (this.pageHandler.onPage)\r\n                this.pageHandler.onPage(this, this.shadowTableTemplate.innerHTML, undefined, 0, this.shadowTableTemplate, rows);\r\n            if (this.pageHandler.onLoaded)\r\n                this.pageHandler.onLoaded(this);\r\n        } else {\r\n            this.isUsingChached = false;\r\n            await this.#fetchPages(parallelAsyncFunction, rawData);\r\n            this.saveToCache();\r\n            if (this.pageHandler.onLoaded)\r\n                this.pageHandler.onLoaded(this);\r\n        }\r\n        this.updateInfoBar();\r\n    }\r\n\r\n    async #fetchPages(parallelAsyncFunction: () => Promise<any>, collection: any) {\r\n        let progressBar = insertProgressBar(this.divInfoContainer, this.tableRef.navigationData.steps(), \"loading pages... \");\r\n        progressBar.start();\r\n        if (this.pageHandler.onBeforeLoading)\r\n            this.pageHandler.onBeforeLoading(this);\r\n\r\n        if (parallelAsyncFunction) {\r\n            let doubleResults = await Promise.all([\r\n                this.#doFetchAllPages(collection, progressBar),\r\n                parallelAsyncFunction()\r\n            ]);\r\n            this.parallelData = doubleResults[1];\r\n        } else {\r\n            await this.#doFetchAllPages(collection, progressBar);\r\n        }\r\n    }\r\n\r\n    async #doFetchAllPages(results: any, progressBar: ProgressBar) {\r\n        let offset = 0;\r\n        try {\r\n            while (true) {\r\n                console.log(\"fetching page \" + offset);\r\n                let response = await fetch(this.tableRef.buildFetchUrl(offset));\r\n                let text = await response.text();\r\n                let template: HTMLTemplateElement;\r\n                if(offset === 0) {\r\n                    this.shadowTableTemplate = document.createElement('template');\r\n                    this.shadowTableTemplate.innerHTML = text;\r\n                    template = this.shadowTableTemplate;\r\n                } else {\r\n                    template = document.createElement('template');\r\n                    template.innerHTML = text;\r\n                }\r\n                let rows = template.content.querySelectorAll(\"tbody > tr\") as NodeListOf<HTMLTableRowElement>;\r\n                if (this.pageHandler.onPage)\r\n                    this.pageHandler.onPage(this, text, results, offset, template, rows);\r\n                if(offset !== 0) {\r\n                    this.shadowTableTemplate.content.querySelector(\"tbody\").append(...rows);\r\n                }\r\n                offset += this.tableRef.navigationData.step;\r\n                if (!progressBar.next())\r\n                    break;\r\n            }\r\n        } finally {\r\n            progressBar.stop();\r\n        }\r\n        return results;\r\n    }\r\n}\r\n\r\n\r\n", "export async function fetchVakken(clear: boolean) {\r\n    if (clear) {\r\n        await sendClearWerklijst();\r\n    }\r\n    await sendAddCriterium(\"2024-2025\", \"Vak\");\r\n    let text = await fetchCritera(\"2024-2025\");\r\n    const template = document.createElement('template');\r\n    template.innerHTML = text;\r\n    let vakken = template.content.querySelectorAll(\"#form_field_leerling_werklijst_criterium_vak option\");\r\n    return Array.from(vakken).map((vak: HTMLOptionElement) => [vak.label, vak.value]);\r\n}\r\n\r\nexport async function fetchCritera(schoolYear: string) {\r\n    return (await fetch(\"https://administratie.dko3.cloud/views/leerlingen/werklijst/index.criteria.php?schooljaar=\" + schoolYear, {\r\n        method: \"GET\"\r\n    })).text();\r\n}\r\n\r\nasync function sendAddCriterium(schoolYear: string, criterium: string) {\r\n    const formData = new FormData();\r\n    formData.append(`criterium`, criterium);\r\n    formData.append(`schooljaar`, schoolYear);\r\n    await fetch(\"https://administratie.dko3.cloud/views/leerlingen/werklijst/index.criteria.session_add.php\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n    });\r\n}\r\n\r\nexport async function sendClearWerklijst() {\r\n    const formData = new FormData();\r\n\r\n    formData.append(\"session\", \"leerlingen_werklijst\");\r\n\r\n    await fetch(\"/views/util/clear_session.php\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n    });\r\n\r\n    //needed to prefill the default fields.\r\n    await fetch(\"views/leerlingen/werklijst/index.velden.php\", {\r\n        method: \"GET\"\r\n    });\r\n}\r\n\r\nexport async function sendCriteria(criteria: object) {\r\n    const formData = new FormData();\r\n\r\n    formData.append(\"criteria\", JSON.stringify(criteria));\r\n    await fetch(\"/views/leerlingen/werklijst/index.criteria.session_reload.php\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n    });\r\n}\r\n\r\nexport async function sendGrouping(grouping: string) {\r\n    const formData = new FormData();\r\n\r\n    formData.append(\"groepering\", grouping);\r\n    await fetch(\"/views/leerlingen/werklijst/index.groeperen.session_add.php\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n    });\r\n}\r\n\r\nexport async function sendFields(fields: { value: string, text: string }[]) {\r\n    const formData = new FormData();\r\n\r\n    let fieldCnt = 0;\r\n    for (let field of fields) {\r\n        formData.append(`velden[${fieldCnt}][value]`, field.value);\r\n        formData.append(`velden[${fieldCnt}][text]`, field.text);\r\n        fieldCnt++;\r\n    }\r\n    await fetch(\"/views/leerlingen/werklijst/index.velden.session_add.php\", {\r\n        method: \"POST\",\r\n        body: formData,\r\n    });\r\n}", "import * as def from \"./def.js\";\r\n\r\nexport function clearPageState() {\r\n    sessionStorage.removeItem(def.STORAGE_PAGE_STATE_KEY);\r\n}\r\n\r\nexport function savePageState(state: PageState) {\r\n    sessionStorage.setItem(def.STORAGE_PAGE_STATE_KEY, JSON.stringify(state));\r\n}\r\n\r\nexport function getPageState(): PageState {\r\n    return JSON.parse(sessionStorage.getItem(def.STORAGE_PAGE_STATE_KEY));\r\n}\r\n\r\nfunction defaultPageState(pageName: PageName) {\r\n    if (pageName === PageName.Werklijst) {\r\n        let werklijstPageState: WerklijstPageState = {\r\n            goto: Goto.None,\r\n            pageName: PageName.Werklijst,\r\n            werklijstTableName: \"\"\r\n        }\r\n        return werklijstPageState;\r\n    }\r\n    return undefined;\r\n}\r\n\r\nexport function getPageStateOrDefault(pageName: PageName): PageState {\r\n    let pageState = JSON.parse(sessionStorage.getItem(def.STORAGE_PAGE_STATE_KEY));\r\n    if (pageState?.pageName === pageName)\r\n        return pageState;\r\n    else\r\n        return defaultPageState(pageName);\r\n}\r\n\r\nexport enum PageName {\r\n    Werklijst = \"Werklijst\",\r\n}\r\n\r\nexport enum Goto {\r\n    None = \"\",\r\n    Werklijst_uren = \"Werklijst_uren\"\r\n}\r\n\r\nexport interface PageState {\r\n    pageName: PageName;\r\n    goto: Goto;\r\n}\r\n\r\nexport interface WerklijstPageState extends PageState {\r\n    werklijstTableName: string;\r\n}", "import {fetchVakken, sendClearWerklijst, sendCriteria, sendFields, sendGrouping} from \"./criteria.js\";\r\nimport * as def from \"../def.js\";\r\nimport {getPageStateOrDefault, PageName, savePageState, WerklijstPageState} from \"../pageState.js\";\r\n\r\nexport let instrumentSet = new Set([\r\n    \"Accordeon\",\r\n    \"Altfluit\",\r\n    \"Althoorn\",\r\n    \"Altklarinet\",\r\n    \"Altsaxofoon\",\r\n    \"Altsaxofoon (jazz pop rock)\",\r\n    \"Altviool\",\r\n    \"Baglama/saz (wereldmuziek)\",\r\n    \"Bariton\",\r\n    \"Baritonsaxofoon\",\r\n    \"Baritonsaxofoon (jazz pop rock)\",\r\n    \"Basfluit\",\r\n    \"Basgitaar (jazz pop rock)\",\r\n    \"Basklarinet\",\r\n    \"Bastrombone\",\r\n    \"Bastuba\",\r\n    \"Bugel\",\r\n    \"Cello\",\r\n    \"Contrabas (jazz pop rock)\",\r\n    \"Contrabas (klassiek)\",\r\n    \"Dwarsfluit\",\r\n    \"Engelse hoorn\",\r\n    \"Eufonium\",\r\n    \"Fagot\",\r\n    \"Gitaar\",\r\n    \"Gitaar (jazz pop rock)\",\r\n    \"Harp\",\r\n    \"Hobo\",\r\n    \"Hoorn\",\r\n    \"Keyboard (jazz pop rock)\",\r\n    \"Klarinet\",\r\n    \"Kornet\",\r\n    \"Orgel\",\r\n    \"Piano\",\r\n    \"Piano (jazz pop rock)\",\r\n    \"Pianolab\",\r\n    \"Piccolo\",\r\n    \"Slagwerk\",\r\n    \"Slagwerk (jazz pop rock)\",\r\n    \"Sopraansaxofoon\",\r\n    \"Sopraansaxofoon (jazz pop rock)\",\r\n    \"Tenorsaxofoon\",\r\n    \"Tenorsaxofoon (jazz pop rock)\",\r\n    \"Trombone\",\r\n    \"Trompet\",\r\n    \"Trompet (jazz pop rock)\",\r\n    \"Ud (wereldmuziek)\",\r\n    \"Viool\",\r\n    \"Zang\",\r\n    \"Zang (jazz pop rock)\",\r\n    \"Zang (musical 2e graad)\",\r\n    \"Zang (musical)\",\r\n]);\r\n\r\nexport async function prefillInstruments() {\r\n    await sendClearWerklijst();\r\n    let vakken = await fetchVakken(false);\r\n    let instruments = vakken.filter((vak) => isInstrument(vak[0]));\r\n    let values = instruments.map(vak => parseInt(vak[1]));\r\n    let valueString = values.join();\r\n\r\n    let criteria = [\r\n        {\"criteria\": \"Schooljaar\", \"operator\": \"=\", \"values\": \"2024-2025\"},\r\n        {\"criteria\": \"Status\", \"operator\": \"=\", \"values\": \"12\"},\r\n        {\"criteria\": \"Uitschrijvingen\", \"operator\": \"=\", \"values\": \"0\"},\r\n        {\"criteria\": \"Domein\", \"operator\": \"=\", \"values\": \"3\"},\r\n        {\r\n            \"criteria\": \"Vak\",\r\n            \"operator\": \"=\",\r\n            \"values\": valueString\r\n        }\r\n    ];\r\n    await sendCriteria(criteria);\r\n    await sendFields([\r\n        {value: \"vak_naam\", text: \"vak\"},\r\n        {value: \"graad_leerjaar\", text: \"graad + leerjaar\"},\r\n        {value: \"klasleerkracht\", text: \"klasleerkracht\"}]\r\n    );\r\n    await sendGrouping(\"vak_id\");\r\n    let pageState = getPageStateOrDefault(PageName.Werklijst) as WerklijstPageState;\r\n    pageState.werklijstTableName = def.UREN_TABLE_STATE_NAME;\r\n    savePageState(pageState);\r\n    (document.querySelector(\"#btn_werklijst_maken\") as HTMLButtonElement).click();\r\n}\r\n\r\nfunction isInstrument(text: string) {\r\n    return instrumentSet.has(text);\r\n}", "import {TableDef} from \"./table/tableDef.js\";\r\n\r\n/**\r\n * @returns `true` to continue, `false` to cancel further handling.\r\n */\r\ntype OnRowHandler = (tableDef: TableDef, rowObject: RowObject, collection: any) => boolean;\r\n\r\ntype OnBeforeLoadingHandler = (tableDef: TableDef) => void;\r\ntype OnLoadedHandler = (tableDef: TableDef) => void;\r\ntype OnRequiredColumnsMissingHandler = (tableDef: TableDef) => void;\r\ntype OnPageHandler = (tableDef: TableDef, text: string, collection: any, offset: number, template: HTMLTemplateElement, rows: NodeListOf<HTMLTableRowElement>) => void;\r\n\r\nexport interface PageHandler {\r\n    onPage: OnPageHandler;\r\n    onLoaded: OnLoadedHandler;\r\n    onBeforeLoading?: OnBeforeLoadingHandler;\r\n}\r\n\r\nexport class RowObject {\r\n    tr: HTMLTableRowElement;\r\n    offset: number;\r\n    index: number;\r\n}\r\n\r\nexport class RowPageHandler implements PageHandler {\r\n    private readonly onRow: OnRowHandler;\r\n    onBeforeLoading?: OnBeforeLoadingHandler;\r\n    onLoaded: OnLoadedHandler;\r\n\r\n    constructor(onRow: OnRowHandler, onLoaded: OnLoadedHandler, onBeforeLoading: OnBeforeLoadingHandler) {\r\n        this.onRow = onRow;\r\n        this.onBeforeLoading = onBeforeLoading;\r\n        this.onLoaded = onLoaded;\r\n    }\r\n\r\n    onPage: OnPageHandler = (tableDef: TableDef, _text: string, collection: any, offset: number, _template, rows) => {\r\n        if(!this.onRow)\r\n            return;\r\n        let index = 0;\r\n        for (let row of rows) {\r\n            let rowObject = new RowObject();\r\n            rowObject.tr = row;\r\n            rowObject.offset = offset;\r\n            rowObject.index = index;\r\n            if (!this.onRow(tableDef, rowObject, collection))\r\n                return;\r\n            index++;\r\n        }\r\n    }\r\n}\r\n\r\nexport class SimpleTableHandler implements PageHandler {\r\n    onBeforeLoading?: OnBeforeLoadingHandler;\r\n    onLoaded: OnLoadedHandler;\r\n    onPage: OnPageHandler;\r\n\r\n    constructor(onLoaded: OnLoadedHandler, onBeforeLoading: OnBeforeLoadingHandler) {\r\n        this.onBeforeLoading = onBeforeLoading;\r\n        this.onLoaded = onLoaded;\r\n        this.onPage = undefined;\r\n    }\r\n}\r\n\r\n/**\r\n * PageHandler with named column labels.\\\r\n * Params are:\r\n * @description\r\n *      * requiredHeaderLabels: array with labels of required columns.\r\n *      * onRow: function(rowObject, collection): a row handler that mainly provides a param `rowObject`, which has a member getColumnText(columnLabel)\r\n * @implements PageHandler: which requires member `onPage()`\r\n */\r\nexport class NamedCellPageHandler implements PageHandler {\r\n    private requiredHeaderLabels: string[];\r\n    onBeforeLoading?: OnBeforeLoadingHandler;\r\n    private headerIndices: Map<string, number>;\r\n    onLoaded: OnLoadedHandler;\r\n    onLoadedExternal: OnLoadedHandler;\r\n    onColumnsMissing: OnRequiredColumnsMissingHandler;\r\n    isValidPage: boolean;\r\n\r\n    constructor(requiredHeaderLabels: string[], onLoaded: OnLoadedHandler, onRequiredColumnsMissing: OnRequiredColumnsMissingHandler) {\r\n        this.requiredHeaderLabels = requiredHeaderLabels;\r\n        this.onLoaded = this.onLoadedAndCheck;\r\n        this.onLoadedExternal = onLoaded;\r\n        this.onColumnsMissing = onRequiredColumnsMissing;\r\n        this.headerIndices = undefined;\r\n        this.isValidPage = false;\r\n    }\r\n\r\n    onLoadedAndCheck: OnLoadedHandler =  (tableDef: TableDef) => {\r\n        if(this.isValidPage)\r\n            this.onLoadedExternal(tableDef);\r\n        else\r\n            console.log(\"NamedCellPageHandler: Not calling OnLoaded handler because page is not valid.\")\r\n    }\r\n\r\n    onPage: OnPageHandler = (_tableDef: TableDef, _text: string, _collection: any, offset: number, template, _rows)  => {\r\n        if(offset === 0) {\r\n            if (!this.setTemplateAndCheck(template)) {\r\n                this.isValidPage = false;\r\n                if (this.onColumnsMissing) {\r\n                    this.onColumnsMissing(_tableDef);\r\n                } else {\r\n                    throw (\"Cannot build table object - required columns missing\");\r\n                }\r\n            } else {\r\n                this.isValidPage = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    setTemplateAndCheck(template: HTMLTemplateElement) {\r\n        this.headerIndices = NamedCellPageHandler.getHeaderIndices(template);\r\n        if (!this.hasAllHeaders()) {\r\n            let labelString = this.requiredHeaderLabels\r\n                .map((label) => \"\\\"\" + label.toUpperCase() + \"\\\"\")\r\n                .join(\", \");\r\n            alert(`Voeg velden ${labelString} toe.`);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    static getHeaderIndices(template: HTMLTemplateElement) {\r\n        let headers = template.content.querySelectorAll(\"thead th\") as NodeListOf<HTMLTableCellElement>;\r\n\r\n        let headerIndices: Map<string, number> = new Map();\r\n        Array.from(headers)\r\n            .forEach((header, index) => {\r\n                let label = header.textContent;\r\n                if (label.startsWith(\"e-mailadressen\")) {\r\n                    headerIndices.set(\"e-mailadressen\", index);\r\n                } else {\r\n                    headerIndices.set(label, index);\r\n                }\r\n            });\r\n        return headerIndices;\r\n    }\r\n\r\n    hasAllHeaders() {\r\n        return this.requiredHeaderLabels.every((label) => this.hasHeader(label))\r\n    }\r\n\r\n    hasHeader(label: string) {\r\n        return this.headerIndices.has(label);\r\n    }\r\n\r\n    getColumnText(tr: HTMLTableRowElement, label: string) : string {\r\n        return tr.children[this.headerIndices.get(label)].textContent;\r\n    }\r\n}", "import {rangeGenerator} from \"../globals.js\";\r\n\r\nfunction sortRowsAlpha(wasAscending: boolean, rows: HTMLTableRowElement[], index: number, header: Element) {\r\n    if (wasAscending) {\r\n        rows.sort((a, b) => {\r\n            return b.cells[index].innerText.localeCompare(a.cells[index].innerText);\r\n        })\r\n        header.classList.add(\"sortDescending\");\r\n    } else {\r\n        rows.sort((a, b) => {\r\n            return a.cells[index].innerText.localeCompare(b.cells[index].innerText);\r\n        })\r\n        header.classList.add(\"sortAscending\");\r\n    }\r\n}\r\n\r\nfunction trySortTableNumeric(wasAscending: boolean, rows: HTMLTableRowElement[], index: number, header: Element) {\r\n    try {\r\n        if (wasAscending) {\r\n            rows.sort((a, b) => {\r\n                let res = Number(b.cells[index].innerText) - Number(a.cells[index].innerText);\r\n                if(isNaN(res)) {\r\n                    throw new Error();\r\n                }\r\n                return res;\r\n            })\r\n            header.classList.add(\"sortDescending\");\r\n        } else {\r\n            rows.sort((a, b) => {\r\n            let res = Number(a.cells[index].innerText) - Number(b.cells[index].innerText);\r\n                if(isNaN(res)) {\r\n                    throw new Error();\r\n                }\r\n                return res;\r\n            })\r\n            header.classList.add(\"sortAscending\");\r\n        }\r\n        return true;\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction sortTableByColumn(table: HTMLTableElement, index: number) {\r\n    let header = table.tHead.children[0].children[index];\r\n    let rows = Array.from(table.tBodies[0].rows);\r\n    let wasAscending = header.classList.contains(\"sortAscending\");\r\n    for (let thead of table.tHead.children[0].children) {\r\n        thead.classList.remove(\"sortAscending\", \"sortDescending\")\r\n    }\r\n    if(isColumnProbablyNumeric(table, index)) {\r\n        if(!trySortTableNumeric(wasAscending, rows, index, header))\r\n            sortRowsAlpha(wasAscending, rows, index, header);\r\n    } else {\r\n        sortRowsAlpha(wasAscending, rows, index, header);\r\n    }\r\n    rows.forEach(row => table.tBodies[0].appendChild(row));\r\n}\r\n\r\nfunction isColumnProbablyNumeric(table: HTMLTableElement, index: number) {\r\n    let rows = Array.from(table.tBodies[0].rows);\r\n\r\n    const MAX_SAMPLES = 100;\r\n    let samples = rangeGenerator(0, rows.length, rows.length > MAX_SAMPLES ? rows.length/MAX_SAMPLES : 1)\r\n        .map(float => Math.floor(float));\r\n    return !samples\r\n        .map(rowIndex => rows[rowIndex])\r\n        .some(row => {\r\n            return isNaN(Number((row.children[index] as HTMLElement).innerText));\r\n        });\r\n}\r\n\r\nexport function addTableHeaderClickEvents(table: HTMLTableElement) {\r\n    if (table.tHead.classList.contains(\"clickHandler\"))\r\n        return;\r\n    table.tHead.classList.add(\"clickHandler\");\r\n    Array.from(table.tHead.children[0].children).forEach((header: HTMLElement, index) => {\r\n        header.onclick = _ev => {\r\n            sortTableByColumn(table, index);\r\n        };\r\n    });\r\n}", "import {addButton, getSchoolIdString, setButtonHighlighted} from \"../globals.js\";\r\nimport * as def from \"../def.js\";\r\nimport {buildTable, getUrenVakLeraarFileName, JsonCloudData} from \"./buildUren.js\";\r\nimport {scrapeStudent, VakLeraar} from \"./scrapeUren.js\";\r\nimport {fetchFromCloud} from \"../cloud.js\";\r\nimport {CalculateTableCheckSumHandler, findTableRefInCode, TableDef} from \"../table/tableDef.js\";\r\nimport {prefillInstruments} from \"./prefillInstruments.js\";\r\nimport {HashObserver} from \"../pageObserver.js\";\r\nimport {NamedCellPageHandler} from \"../pageHandlers.js\";\r\nimport {addTableHeaderClickEvents} from \"../table/tableHeaders.js\";\r\nimport {getPageStateOrDefault, Goto, PageName, savePageState, WerklijstPageState} from \"../pageState.js\";\r\n\r\nexport default new HashObserver(\"#leerlingen-werklijst\", onMutation);\r\n\r\nfunction onMutation(mutation: MutationRecord) {\r\n    if ((mutation.target as HTMLElement).id === \"table_leerlingen_werklijst_table\") {\r\n        onWerklijstChanged();\r\n        return true;\r\n    }\r\n    let buttonBar = document.getElementById(\"tablenav_leerlingen_werklijst_top\");\r\n    if (mutation.target === buttonBar) {\r\n        onButtonBarChanged();\r\n        return true;\r\n    }\r\n    if (document.querySelector(\"#btn_werklijst_maken\")) {\r\n        onCriteriaShown();\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction onCriteriaShown() {\r\n    let pageState = getPageStateOrDefault(PageName.Werklijst) as WerklijstPageState;\r\n    if(pageState.goto == Goto.Werklijst_uren) {\r\n        pageState.goto = Goto.None;\r\n        savePageState(pageState);\r\n        prefillInstruments().then(() => {});\r\n        return;\r\n    }\r\n    pageState.werklijstTableName = \"\";\r\n    savePageState(pageState);\r\n    let btnWerklijstMaken = document.querySelector(\"#btn_werklijst_maken\") as HTMLButtonElement;\r\n    if(document.getElementById(def.PREFILL_INSTR_BTN_ID))\r\n        return;\r\n\r\n    addButton(btnWerklijstMaken, def.PREFILL_INSTR_BTN_ID, \"Prefill instrumenten\", prefillInstruments, \"fa-guitar\", [\"btn\", \"btn-outline-dark\"], \"Uren \");\r\n    getSchoolIdString();\r\n}\r\n\r\nexport let getCriteriaString: CalculateTableCheckSumHandler =  (_tableDef: TableDef) => {\r\n    return document.querySelector(\"#view_contents > div.alert.alert-info\")?.textContent.replace(\"Criteria aanpassen\", \"\")?.replace(\"Criteria:\", \"\") ?? \"\";\r\n}\r\n\r\nfunction onWerklijstChanged() {\r\n    let werklijstPageState = getPageStateOrDefault(PageName.Werklijst) as WerklijstPageState;\r\n    if(werklijstPageState.werklijstTableName === def.UREN_TABLE_STATE_NAME) {\r\n        tryUntil(onClickShowCounts);\r\n    }\r\n    addTableHeaderClickEvents(document.querySelector(\"table#table_leerlingen_werklijst_table\") as HTMLTableElement);\r\n}\r\n\r\nfunction onButtonBarChanged() {\r\n    let targetButton = document.querySelector(\"#tablenav_leerlingen_werklijst_top > div > div.btn-group.btn-group-sm.datatable-buttons > button:nth-child(1)\") as HTMLButtonElement;\r\n    addButton(targetButton, def.COUNT_BUTTON_ID, \"Toon telling\", onClickShowCounts, \"fa-guitar\", [\"btn-outline-info\"]);\r\n    addButton(targetButton, def.MAIL_BTN_ID, \"Email to clipboard\", onClickCopyEmails, \"fa-envelope\", [\"btn\", \"btn-outline-info\"]);\r\n}\r\n\r\nfunction onClickCopyEmails() {\r\n    let requiredHeaderLabels = [\"e-mailadressen\"];\r\n\r\n    let pageHandler = new NamedCellPageHandler(requiredHeaderLabels, onEmailPageLoaded, tableDef1 => {\r\n        navigator.clipboard.writeText(\"\").then(value => {\r\n            console.log(\"Clipboard cleared.\")\r\n        });\r\n    });\r\n\r\n    let tableDef = new TableDef(\r\n        findTableRefInCode(),\r\n        pageHandler,\r\n        getCriteriaString\r\n    );\r\n\r\n    function onEmailPageLoaded(tableDef: TableDef) {\r\n        let rows = this.rows = tableDef.shadowTableTemplate.content.querySelectorAll(\"tbody > tr\") as NodeListOf<HTMLTableRowElement>;\r\n        let allEmails = Array.from(rows)\r\n            .map(tr=> (tableDef.pageHandler as NamedCellPageHandler).getColumnText(tr, \"e-mailadressen\"));\r\n\r\n        let flattened = allEmails\r\n            .map((emails: string) => emails.split(/[,;]/))\r\n            .flat()\r\n            .filter((email: string) => !email.includes(\"@academiestudent.be\"))\r\n            .filter((email: string) => email !== \"\");\r\n        navigator.clipboard.writeText(flattened.join(\";\\n\")).then(() =>\r\n            tableDef.setTempMessage(\"Alle emails zijn naar het clipboard gekopieerd. Je kan ze plakken in Outlook.\")\r\n        );\r\n    }\r\n\r\n    tableDef.getTableData([], undefined )\r\n        .then((_results) => {\r\n        });\r\n}\r\n\r\nfunction tryUntil(func: () => boolean) {\r\n    if(!func())\r\n        setTimeout(() => tryUntil(func), 100);\r\n}\r\n\r\nfunction onClickShowCounts() {\r\n    //Build lazily and only once. Table will automatically be erased when filters are changed.\r\n    if (!document.getElementById(def.COUNT_TABLE_ID)) {\r\n        let tableRef = findTableRefInCode();\r\n        if(!tableRef)\r\n            return false;\r\n\r\n        let fileName = getUrenVakLeraarFileName();\r\n        let requiredHeaderLabels = [\"naam\", \"voornaam\", \"vak\", \"klasleerkracht\", \"graad + leerjaar\"];\r\n        let pageHandler = new NamedCellPageHandler(requiredHeaderLabels, onLoaded, () => {});\r\n        let tableDef = new TableDef(\r\n            tableRef,\r\n            pageHandler,\r\n            getCriteriaString\r\n        );\r\n\r\n        function onLoaded(tableDef: TableDef) {\r\n            let vakLeraars = new Map();\r\n            let rows = this.rows = tableDef.shadowTableTemplate.content.querySelectorAll(\"tbody > tr\") as NodeListOf<HTMLTableRowElement>;\r\n            for(let tr of rows) {\r\n                scrapeStudent(tableDef, tr, vakLeraars);//TODO: returns false if fails. Report error.\r\n            }\r\n            let fromCloud = tableDef.parallelData as JsonCloudData;\r\n            fromCloud = upgradeCloudData(fromCloud);\r\n            vakLeraars = new Map([...vakLeraars.entries()].sort((a, b) => a[0] < b[0] ? -1 : ((a[0] > b[0])? 1 : 0))) as Map<string, VakLeraar>;\r\n            buildTable({vakLeraars, fromCloud}, tableDef);\r\n            document.getElementById(def.COUNT_TABLE_ID).style.display = \"none\";\r\n            showOrHideNewTable();\r\n        }\r\n\r\n        tableDef.getTableData(new Map(), () => fetchFromCloud(fileName))\r\n            .then((_results) => { });\r\n        return true;\r\n    }\r\n    showOrHideNewTable();\r\n    return true;\r\n}\r\n\r\nfunction showOrHideNewTable() {\r\n    let showNewTable = document.getElementById(def.COUNT_TABLE_ID).style.display === \"none\";\r\n    document.getElementById(\"table_leerlingen_werklijst_table\").style.display = showNewTable ? \"none\" : \"table\";\r\n    document.getElementById(def.COUNT_TABLE_ID).style.display = showNewTable ? \"table\" : \"none\";\r\n    document.getElementById(def.COUNT_BUTTON_ID).title = showNewTable ? \"Toon normaal\" : \"Toon telling\";\r\n    setButtonHighlighted(def.COUNT_BUTTON_ID, showNewTable);\r\n    let pageState = getPageStateOrDefault(PageName.Werklijst) as WerklijstPageState;\r\n    pageState.werklijstTableName = showNewTable ? def.UREN_TABLE_STATE_NAME : \"\";\r\n    savePageState(pageState);\r\n}\r\n\r\nfunction upgradeCloudData(fromCloud: JsonCloudData) {\r\n    //if fromCloud.version === \"....\" --> convert.\r\n    return fromCloud;\r\n\r\n\r\n}\r\n", "import {addButton} from \"../globals.js\";\r\nimport * as def from \"../def.js\";\r\nimport {AllPageFilter, BaseObserver} from \"../pageObserver.js\";\r\nimport {SimpleTableHandler} from \"../pageHandlers.js\";\r\nimport {findTableRefInCode, TableDef} from \"./tableDef.js\";\r\nimport {addTableHeaderClickEvents} from \"./tableHeaders.js\";\r\nimport {getCriteriaString} from \"../werklijst/observer.js\";\r\n\r\nexport default new BaseObserver(undefined, new AllPageFilter(), onMutation);\r\n\r\nfunction onMutation (_mutation: MutationRecord) {\r\n    let navigationBar = document.querySelector(\"div.datatable-navigation-toolbar\") as HTMLElement;\r\n    if(!navigationBar)\r\n        return false;\r\n    if(!findTableRefInCode()?.navigationData.isOnePage()) {\r\n        addButton(navigationBar.lastElementChild as HTMLElement, def.DOWNLOAD_TABLE_BTN_ID, \"download full table\", downloadTable, \"fa-arrow-down\", [\"btn-secondary\"], \"\", \"afterend\");\r\n    }\r\n    if(document.querySelector(\"main div.table-responsive table thead\")) {\r\n        addTableHeaderClickEvents(document.querySelector(\"main div.table-responsive table\"));\r\n    }\r\n    let customTable = document.querySelector(\"table.canSort\") as HTMLTableElement;\r\n    if(customTable) {\r\n        addTableHeaderClickEvents(customTable);\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction downloadTable() {\r\n    let prebuildPageHandler = new SimpleTableHandler(onLoaded, undefined);\r\n\r\n    function onLoaded(tableDef: TableDef) {\r\n        let template = tableDef.shadowTableTemplate;\r\n        tableDef.tableRef.getOrgTable()\r\n            .querySelector(\"tbody\")\r\n            .replaceChildren(...template.content.querySelectorAll(\"tbody tr\"));\r\n    }\r\n\r\n    // let tableRef = new TableRef(\"table_leerlingen_werklijst_table\", findFirstNavigation(),(offset) => \"/views/ui/datatable.php?id=leerlingen_werklijst&start=\" + offset + \"&aantal=0\");\r\n    let tableRef = findTableRefInCode();\r\n    let tableDef = new TableDef(\r\n        tableRef,\r\n        prebuildPageHandler,\r\n        getCriteriaString\r\n    );\r\n\r\n    tableDef.getTableData().then(() => { });\r\n}\r\n", "import {clamp, isAlphaNumeric} from \"./globals.js\";\r\nimport * as def from \"./def.js\";\r\nimport {getPageStateOrDefault, Goto, PageName, savePageState} from \"./pageState.js\";\r\n\r\nlet powerQueryItems: QueryItem[] = [];\r\nlet popoverVisible = false;\r\nlet selectedItem = 0;\r\ntype GotoFunc = (queryItem: QueryItem) => void;\r\n\r\nexport interface QueryItem {\r\n    headerLabel: string;\r\n    label: string;\r\n    href: string;\r\n    weight: number;\r\n    longLabel: string;\r\n    lowerCase: string;\r\n    func?: GotoFunc;\r\n}\r\n\r\nexport function saveQueryItems(page: string, queryItems: QueryItem[]) {\r\n    let savedPowerQueryString = localStorage.getItem(def.POWER_QUERY_ID);\r\n    if(!savedPowerQueryString) {\r\n        savedPowerQueryString = \"{}\";\r\n    }\r\n    let savedPowerQuery = JSON.parse(savedPowerQueryString);\r\n    savedPowerQuery[page] = queryItems;\r\n    localStorage.setItem(def.POWER_QUERY_ID, JSON.stringify(savedPowerQuery));\r\n}\r\n\r\nfunction getSavedQueryItems(): QueryItem[] {\r\n    let savedPowerQueryString = localStorage.getItem(def.POWER_QUERY_ID);\r\n    if(!savedPowerQueryString) {\r\n        return [];\r\n    }\r\n    let allItems = [];\r\n    let savedPowerQuery = JSON.parse(savedPowerQueryString);\r\n    for(let page in savedPowerQuery) {\r\n        allItems.push(...savedPowerQuery[page]);\r\n    }\r\n    return allItems;\r\n}\r\n\r\nfunction screpeDropDownMenu(headerMenu: Element) {\r\n    let headerLabel = headerMenu.querySelector(\"a\").textContent.trim();\r\n\r\n    let newItems = Array.from(headerMenu.querySelectorAll(\"div.dropdown-menu > a\") as NodeListOf<HTMLAnchorElement>)\r\n        .map((item) => {\r\n            let queryItem: QueryItem = {\r\n                func: undefined,\r\n                headerLabel,\r\n                label: item.textContent.trim(),\r\n                href: item.href,\r\n                weight: 0,\r\n                longLabel: \"\",\r\n                lowerCase: \"\"\r\n            };\r\n            queryItem.longLabel = queryItem.headerLabel + \" > \" + queryItem.label;\r\n            queryItem.lowerCase = queryItem.longLabel.toLowerCase();\r\n            return queryItem;\r\n        })\r\n        .filter((item) => item.label != \"\" && item.href != \"\" && item.href != \"https://administratie.dko3.cloud/#\");\r\n    powerQueryItems.push(...newItems);\r\n}\r\n\r\nfunction scrapeMainMenu() {\r\n    powerQueryItems = [];\r\n    let menu = document.getElementById(\"dko3_navbar\");\r\n    let headerMenus = menu.querySelectorAll(\"#dko3_navbar > ul.navbar-nav > li.nav-item.dropdown\");\r\n    for(let headerMenu of headerMenus.values()) {\r\n        screpeDropDownMenu(headerMenu);\r\n    }\r\n}\r\n\r\nexport function setupPowerQuery() {\r\n    //don' do nottin' - just initialize this module, below.\r\n}\r\n\r\nfunction gotoWerklijstUren(_queryItem: QueryItem) {\r\n    let pageState = getPageStateOrDefault(PageName.Werklijst);\r\n    pageState.goto = Goto.Werklijst_uren;\r\n    savePageState(pageState);\r\n    location.href = \"/#leerlingen-werklijst\";\r\n}\r\n\r\nfunction getHardCodedQueryItems() {\r\n    let items: QueryItem[] = [];\r\n    let item: QueryItem = {\r\n        headerLabel: \"Werklijst\", href: \"\", label: \"Uren per vak per leraar\", longLabel: \"\", lowerCase: \"\", weight: 0\r\n    }\r\n    item.longLabel = item.headerLabel + \" > \" + item.label;\r\n    item.lowerCase = item.longLabel.toLowerCase();\r\n    item.func = gotoWerklijstUren;\r\n    items.push(item);\r\n    return items;\r\n}\r\n\r\ndocument.body.addEventListener(\"keydown\", showPowerQuery);\r\n\r\nfunction showPowerQuery(ev: KeyboardEvent) {\r\n    if (ev.key === \"q\" && ev.ctrlKey && !ev.shiftKey && !ev.altKey) {\r\n        scrapeMainMenu();\r\n        powerQueryItems.push(...getSavedQueryItems());\r\n        powerQueryItems.push(...getHardCodedQueryItems());\r\n        popover.showPopover();\r\n    } else {\r\n        if (popoverVisible === false)\r\n            return;\r\n        if (isAlphaNumeric(ev.key) || ev.key === ' ') {\r\n            searchField.textContent += ev.key;\r\n            selectedItem = 0; //back to top.\r\n        } else if (ev.key == \"Backspace\") {\r\n            searchField.textContent = searchField.textContent.slice(0, -1);\r\n        } else if (ev.key == \"ArrowDown\") {\r\n            selectedItem++;\r\n            ev.preventDefault();\r\n        } else if (ev.key == \"ArrowUp\") {\r\n            selectedItem--;\r\n            ev.preventDefault();\r\n        } else if (ev.key == \"Enter\") {\r\n            let item = powerQueryItems.find((item) => item.longLabel === (list.children[selectedItem] as HTMLElement).dataset.longLabel);\r\n            popover.hidePopover();\r\n            if (item.func) {\r\n                item.func(item);\r\n            } else {\r\n                location.href = item.href;\r\n            }\r\n            ev.preventDefault();\r\n        }\r\n    }\r\n    filterItems(searchField.textContent);\r\n}\r\n\r\nlet popover = document.createElement(\"div\");\r\ndocument.querySelector(\"main\").appendChild(popover);\r\npopover.setAttribute(\"popover\", \"auto\");\r\npopover.id = \"powerQuery\";\r\npopover.addEventListener(\"toggle\", (ev) => {\r\n    // @ts-ignore\r\n    popoverVisible = ev.newState === \"open\";\r\n});\r\nlet searchField = document.createElement(\"label\");\r\npopover.appendChild(searchField);\r\nlet list = document.createElement(\"div\");\r\npopover.appendChild(list);\r\nlist.classList.add(\"list\");\r\n\r\nfunction filterItems(needle: string) {\r\n    for (const item of powerQueryItems) {\r\n        item.weight = 0;\r\n        //exact match\r\n        if (item.lowerCase.includes(needle))\r\n            item.weight += 1000;\r\n\r\n        //exact match of each word in needle.\r\n        let needleWordsWithSeparator = needle.split(/(?= )/g);\r\n        if (needleWordsWithSeparator.every(word => item.lowerCase.includes(word)))\r\n            item.weight += 500;\r\n\r\n        //all chars match  in order\r\n        let indices = needle.split('')\r\n            .map(char => item.lowerCase.indexOf(char));\r\n        if(indices.every(num => num !== -1) && isSorted(indices))\r\n            item.weight += 50;\r\n\r\n        //all chars match\r\n        if (needle.split('')\r\n            .every(char => item.lowerCase.includes(char)))\r\n            item.weight += 20;\r\n    }\r\n\r\n    const MAX_VISIBLE_QUERY_ITEMS = 30;\r\n    list.innerHTML = powerQueryItems\r\n        .filter((item) => item.weight != 0)\r\n        .sort((a, b) => b.weight - a.weight)\r\n        .map((item) => `<div data-long-label=\"${item.longLabel}\">${item.longLabel}</div>`)\r\n        .slice(0, MAX_VISIBLE_QUERY_ITEMS)\r\n        .join(\"\\n\");\r\n    selectedItem = clamp(selectedItem, 0, list.children.length - 1);\r\n    list.children[selectedItem]?.classList.add(\"selected\");\r\n}\r\n\r\nfunction isSorted(arr: number[]) {\r\n    for (let i = 0; i < arr.length - 1; i++) {\r\n        if (arr[i] > arr[i + 1]) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}", "import {ExactHashObserver, HashObserver} from \"../pageObserver.js\";\r\nimport {QueryItem, saveQueryItems} from \"../setupPowerQuery.js\";\r\n\r\nexport let extraInschrijvingenObserver = new ExactHashObserver(\"#extra-inschrijvingen\", onMutationExtraInschrijvingen);\r\nexport let allLijstenObserver = new ExactHashObserver(\"#leerlingen-lijsten\", onMutationAlleLijsten);\r\nexport let financialObserver = new ExactHashObserver(\"#extra-financieel\", onMutationFinancial);\r\nexport let assetsObserver = new ExactHashObserver(\"#extra-assets\", onMutationAssets);\r\n\r\ntype LinkToQueryConverter = (headerLabel: string, link: HTMLAnchorElement, longLabelPrefix: string) => QueryItem;\r\n\r\nfunction onMutationAssets(_mutation: MutationRecord) {\r\n    saveQueryItems(\"Assets\", scrapeMenuPage(\"Assets > \", defaultLinkToQueryItem));\r\n    return true;\r\n}\r\n\r\nfunction onMutationFinancial(_mutation: MutationRecord) {\r\n    saveQueryItems(\"Financieel\", scrapeMenuPage(\"Financieel > \", defaultLinkToQueryItem));\r\n    return true;\r\n}\r\n\r\nfunction onMutationAlleLijsten(_mutation: MutationRecord) {\r\n    saveQueryItems(\"Lijsten\", scrapeMenuPage(\"Lijsten > \", defaultLinkToQueryItem));\r\n    return true;\r\n}\r\n\r\nfunction onMutationExtraInschrijvingen(_mutation: MutationRecord) {\r\n    saveQueryItems(\"ExtraInschrijvingen\", scrapeMenuPage(\"Inschrijvingen > \", inschrijvingeLinkToQueryItem));\r\n    return true;\r\n}\r\n\r\nfunction inschrijvingeLinkToQueryItem(headerLabel: string, link: HTMLAnchorElement, longLabelPrefix: string) {\r\n    let item: QueryItem = {\r\n        headerLabel, href: link.href, label: link.textContent.trim(), longLabel: \"\", lowerCase: \"\", weight: 0\r\n    };\r\n    if (item.label.toLowerCase().includes(\"inschrijving\")) {\r\n        item.longLabel = item.headerLabel + \" > \" + item.label;\r\n    } else {\r\n        item.longLabel = longLabelPrefix + item.headerLabel + \" > \" + item.label;\r\n    }\r\n    item.lowerCase = item.longLabel.toLowerCase();\r\n    return item;\r\n}\r\n\r\nfunction defaultLinkToQueryItem(headerLabel: string, link: HTMLAnchorElement, longLabelPrefix: string) {\r\n    let item: QueryItem = {\r\n        headerLabel, href: link.href, label: link.textContent.trim(), longLabel: \"\", lowerCase: \"\", weight: 0\r\n    };\r\n    item.longLabel = longLabelPrefix + item.label;\r\n    item.lowerCase = item.longLabel.toLowerCase();\r\n    return item;\r\n}\r\n\r\nfunction scrapeMenuPage(longLabelPrefix: string, linkConverter: LinkToQueryConverter) {\r\n    let queryItems: QueryItem[] = [];\r\n    let blocks = document.querySelectorAll(\"div.card-body\");\r\n    for(let block of blocks){\r\n        let header = block.querySelector('h5');\r\n        if(!header) {\r\n            continue;\r\n        }\r\n        let headerLabel = header.textContent.trim();\r\n        let links = block.querySelectorAll(\"a\");\r\n        for(let link of links) {\r\n            if(!link.href)\r\n                continue;\r\n            let item = linkConverter(headerLabel, link, longLabelPrefix);\r\n            queryItems.push(item);\r\n        }\r\n    }\r\n    return queryItems;\r\n}\r\n", "//to avoid \"unused function\" errors in linters, this file is called as a module.\r\nimport {observers, options, registerObserver} from \"./globals.js\";\r\nimport leerlingObserver from \"./leerling/observer.js\";\r\nimport lessenObserver from \"./lessen/observer.js\";\r\nimport lesObserver from \"./les/observer.js\";\r\nimport academieObserver from \"./academie/observer.js\";\r\nimport werklijstObserver from \"./werklijst/observer.js\";\r\nimport tableObserver from \"./table/observer.js\";\r\nimport {setupPowerQuery} from \"./setupPowerQuery.js\";\r\nimport {allLijstenObserver, assetsObserver, extraInschrijvingenObserver, financialObserver} from \"./pages/observer.js\";\r\n\r\ninit();\r\n\r\n// noinspection JSUnusedGlobalSymbols\r\nfunction init() {\r\n    getOptions(() => {\r\n        // @ts-ignore\r\n        chrome.storage.onChanged.addListener((_changes: any, area: string) => {\r\n            if (area === 'sync') {\r\n                getOptions();\r\n            }\r\n        });\r\n\r\n        // @ts-ignore\r\n        window.navigation.addEventListener(\"navigatesuccess\", () => {\r\n            onPageChanged();\r\n        });\r\n\r\n        window.addEventListener(\"load\", () => {\r\n            onPageChanged();\r\n        });\r\n\r\n        registerObserver(leerlingObserver);\r\n        registerObserver(lessenObserver);\r\n        registerObserver(lesObserver);\r\n        registerObserver(academieObserver);\r\n        registerObserver(werklijstObserver);\r\n        registerObserver(tableObserver);\r\n        registerObserver(extraInschrijvingenObserver);\r\n        registerObserver(allLijstenObserver);\r\n        registerObserver(financialObserver);\r\n        registerObserver(assetsObserver);\r\n        onPageChanged();\r\n        setupPowerQuery();\r\n    });\r\n}\r\n\r\nexport function onPageChanged() {\r\n    // clearPageState();\r\n    for(let observer of observers) {\r\n        observer.onPageChanged();\r\n    }\r\n}\r\n\r\nfunction getOptions(callback?: () => void) {\r\n    // @ts-ignore\r\n    chrome.storage.sync.get(\r\n        null, //get all\r\n        (items: any) => {\r\n            // @ts-ignore\r\n            Object.assign(options, items);\r\n            callback();\r\n        }\r\n    );\r\n}\r\n\r\n"],
  "mappings": "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",
  "names": ["button", "observer_default", "onMutation", "trimDiv", "addButton", "button", "observer_default", "onMutation", "observer_default", "isInstrument", "observer_default", "onMutation", "tableDef", "observer_default", "onMutation", "tableDef", "item", "observer_default"]
}
