{
  "version": 3,
  "sources": ["../typescript/messaging.ts", "../typescript/blank.ts"],
  "sourcesContent": ["export enum Actions {\r\n    OpenHtmlTab = \"open_tab\",\r\n    GetTabData = \"get_tab_data\",\r\n    GetParentTabId = \"get_parent_tab_id\",\r\n    OpenHoursSettings = \"open_hours_settings\",\r\n    GreetingsFromParent = \"greetingsFromParent\",\r\n    GreetingsFromChild = \"greetingsFromChild\",\r\n}\r\n\r\nexport enum TabType {Undefined, Main, HoursSettings}\r\n\r\nexport interface ServiceRequest {\r\n    action: Actions,\r\n    senderTabType: TabType,\r\n    targetTabType: TabType,\r\n    data: any,\r\n    pageTitle?: string,\r\n    senderTabId?: number,\r\n    targetTabId?: number,\r\n}\r\n\r\nexport function sendRequest(action: Actions, from: TabType, to: TabType,  toId: number, data: any, pageTitle?: string) {\r\n    let req: ServiceRequest = {\r\n        action,\r\n        data,\r\n        pageTitle,\r\n        senderTabType: from,\r\n        targetTabType: to,\r\n        targetTabId: toId,\r\n    };\r\n    return chrome.runtime.sendMessage(req);\r\n}\r\n\r\nexport interface ServiceResponse {\r\n    result: any,\r\n    error: string,\r\n}\r\n\r\nexport async function sendGetDataRequest(sender: TabType) {\r\n    let tab = await chrome.tabs.getCurrent();\r\n    return await sendRequest(Actions.GetTabData, sender, TabType.Undefined, undefined, {tabId: tab.id});\r\n}\r\n\r\nexport type MessageHandler = {\r\n    getListener: () => (request: ServiceRequest, _sender, _sendResponse) => void;\r\n    onMessageForMyTabType: (callback: (msg: ServiceRequest) => void) => MessageHandler;\r\n    onMessageForMe: (callback: (msg: ServiceRequest) => void) => MessageHandler;\r\n}\r\n\r\nexport interface InternalMessageHandler extends MessageHandler {\r\n    _onMessageForMyTabType(request: ServiceRequest): void;\r\n\r\n    _onMessageForMe(request: ServiceRequest): void;\r\n}\r\n\r\nexport function createMessageHandler(tabType: TabType): MessageHandler {\r\n    return {\r\n        getListener: function () {\r\n            let self: InternalMessageHandler = this;\r\n            return async function onMessage(request: ServiceRequest, _sender, _sendResponse) {\r\n                console.log(`blank received: `, request);\r\n                if (request.targetTabType === tabType) {\r\n                    self._onMessageForMyTabType?.(request);\r\n                    let tab = await chrome.tabs.getCurrent();\r\n                    if (request.targetTabId === tab.id) {\r\n                        self._onMessageForMe?.(request)\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        onMessageForMyTabType: function (callback: (msg: ServiceRequest) => void): MessageHandler {\r\n            this._onMessageForMyTabType = callback;\r\n            return this;\r\n        },\r\n        onMessageForMe: function (callback: (msg: ServiceRequest) => void): MessageHandler {\r\n            this._onMessageForMe = callback;\r\n            return this;\r\n        },\r\n        _onMessageForMyTabType: undefined,\r\n        _onMessageForMe: undefined\r\n    } as InternalMessageHandler;\r\n}", "import {Actions, createMessageHandler, sendGetDataRequest, sendRequest, TabType} from \"./messaging\";\r\n\r\nlet handler  = createMessageHandler(TabType.HoursSettings);\r\n\r\nchrome.runtime.onMessage.addListener(handler.getListener());\r\n\r\nhandler\r\n    .onMessageForMyTabType(msg => {\r\n        console.log(\"message for my tab type: \", msg);\r\n        document.getElementById(\"container\").innerHTML = \"Message was for my tab type\" + msg.data;\r\n    })\r\n    .onMessageForMe(msg => {\r\n        console.log(\"message for me: \", msg);\r\n        document.getElementById(\"container\").innerHTML = \"DATA:\" + msg.data;\r\n    });\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\r\n    document.querySelector(\"button\").addEventListener(\"click\", async () => {\r\n        await sendRequest(Actions.GreetingsFromChild, TabType.Undefined, TabType.Main, undefined, \"Hullo! Fly safe!\");\r\n    });\r\n    let res = await sendGetDataRequest(TabType.HoursSettings); //todo: where does this id come from?\r\n    console.log(\"tab opened: request data message sent and received: \");\r\n    console.log(res);\r\n    document.getElementById(\"container\").innerHTML = \"Data:\" +  res.data;\r\n    document.title = res.pageTitle;\r\n});\r\n"],
  "mappings": ";;AAqBO,WAAS,YAAY,QAAiB,MAAe,IAAc,MAAc,MAAW,WAAoB;AACnH,QAAI,MAAsB;AAAA,MACtB;AAAA,MACA;AAAA,MACA;AAAA,MACA,eAAe;AAAA,MACf,eAAe;AAAA,MACf,aAAa;AAAA,IACjB;AACA,WAAO,OAAO,QAAQ,YAAY,GAAG;AAAA,EACzC;AAOA,iBAAsB,mBAAmB,QAAiB;AACtD,QAAI,MAAM,MAAM,OAAO,KAAK,WAAW;AACvC,WAAO,MAAM,YAAY,iCAAoB,QAAQ,mBAAmB,QAAW,EAAC,OAAO,IAAI,GAAE,CAAC;AAAA,EACtG;AAcO,WAAS,qBAAqB,SAAkC;AACnE,WAAO;AAAA,MACH,aAAa,WAAY;AACrB,YAAI,OAA+B;AACnC,eAAO,eAAe,UAAU,SAAyB,SAAS,eAAe;AAC7E,kBAAQ,IAAI,oBAAoB,OAAO;AACvC,cAAI,QAAQ,kBAAkB,SAAS;AACnC,iBAAK,yBAAyB,OAAO;AACrC,gBAAI,MAAM,MAAM,OAAO,KAAK,WAAW;AACvC,gBAAI,QAAQ,gBAAgB,IAAI,IAAI;AAChC,mBAAK,kBAAkB,OAAO;AAAA,YAClC;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AAAA,MACA,uBAAuB,SAAU,UAAyD;AACtF,aAAK,yBAAyB;AAC9B,eAAO;AAAA,MACX;AAAA,MACA,gBAAgB,SAAU,UAAyD;AAC/E,aAAK,kBAAkB;AACvB,eAAO;AAAA,MACX;AAAA,MACA,wBAAwB;AAAA,MACxB,iBAAiB;AAAA,IACrB;AAAA,EACJ;;;AC/EA,MAAI,UAAW,0CAA0C;AAEzD,SAAO,QAAQ,UAAU,YAAY,QAAQ,YAAY,CAAC;AAE1D,UACK,sBAAsB,SAAO;AAC1B,YAAQ,IAAI,6BAA6B,GAAG;AAC5C,aAAS,eAAe,WAAW,EAAE,YAAY,gCAAgC,IAAI;AAAA,EACzF,CAAC,EACA,eAAe,SAAO;AACnB,YAAQ,IAAI,oBAAoB,GAAG;AACnC,aAAS,eAAe,WAAW,EAAE,YAAY,UAAU,IAAI;AAAA,EACnE,CAAC;AAEL,WAAS,iBAAiB,oBAAoB,YAAY;AACtD,aAAS,cAAc,QAAQ,EAAE,iBAAiB,SAAS,YAAY;AACnE,YAAM,4FAAyE,QAAW,kBAAkB;AAAA,IAChH,CAAC;AACD,QAAI,MAAM,MAAM,wCAAwC;AACxD,YAAQ,IAAI,sDAAsD;AAClE,YAAQ,IAAI,GAAG;AACf,aAAS,eAAe,WAAW,EAAE,YAAY,UAAW,IAAI;AAChE,aAAS,QAAQ,IAAI;AAAA,EACzB,CAAC;",
  "names": []
}
