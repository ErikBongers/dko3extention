{"version":3,"file":"blank.js","names":["action: Actions","from: TabType","to: TabType","toId: number","data: any","pageTitle?: string","req: ServiceRequest","sender: TabType","tabType: TabType","handler:InternalMessageHandler","self: InternalMessageHandler","request: ServiceRequest","callback: (msg: ServiceRequest) => void","callback: (data: any) => void","handler"],"sources":["../typescript/messaging.ts","../typescript/blank.ts"],"sourcesContent":["export enum Actions {\r\n    OpenHtmlTab = \"open_tab\",\r\n    GetTabData = \"get_tab_data\",\r\n    GetParentTabId = \"get_parent_tab_id\",\r\n    OpenHoursSettings = \"open_hours_settings\",\r\n    HoursSettingsChanged = \"open_hours_settings_changed\",\r\n    GreetingsFromParent = \"greetingsFromParent\",\r\n    GreetingsFromChild = \"greetingsFromChild\",\r\n}\r\n\r\nexport enum TabType {\r\n    Undefined= \"Undefined\",\r\n    Main = \"Main\",\r\n    HoursSettings = \"HoursSettings\",\r\n    Html = \"Html\"\r\n}\r\n\r\nexport interface ServiceRequest {\r\n    action: Actions,\r\n    senderTabType: TabType,\r\n    targetTabType: TabType,\r\n    data: any,\r\n    pageTitle?: string,\r\n    senderTabId?: number,\r\n    targetTabId?: number,\r\n}\r\n\r\nexport function sendRequest(action: Actions, from: TabType, to: TabType,  toId: number, data: any, pageTitle?: string) {\r\n    let req: ServiceRequest = {\r\n        action,\r\n        data,\r\n        pageTitle,\r\n        senderTabType: from,\r\n        targetTabType: to,\r\n        targetTabId: toId,\r\n    };\r\n    return chrome.runtime.sendMessage(req);\r\n}\r\n\r\nexport interface ServiceResponse {\r\n    result: any,\r\n    error: string,\r\n}\r\n\r\nexport async function sendGetDataRequest(sender: TabType) {\r\n    let tab = await chrome.tabs.getCurrent();\r\n    return await sendRequest(Actions.GetTabData, sender, TabType.Undefined, undefined, {tabId: tab.id});\r\n}\r\n\r\nexport type MessageHandler = {\r\n    getListener: () => (request: ServiceRequest, _sender, _sendResponse) => void;\r\n    onMessageForMyTabType: (callback: (msg: ServiceRequest) => void) => MessageHandler;\r\n    onMessageForMe: (callback: (msg: ServiceRequest) => void) => MessageHandler;\r\n    onData: (callback: (data: any) => void) => MessageHandler;\r\n}\r\n\r\nexport interface InternalMessageHandler extends MessageHandler {\r\n    _onMessageForMyTabType(request: ServiceRequest): void;\r\n    _onMessageForMe(request: ServiceRequest): void;\r\n    _onData(data: any): void;\r\n}\r\n\r\nexport function createMessageHandler(tabType: TabType): MessageHandler {\r\n    let handler:InternalMessageHandler = {\r\n        getListener: function () {\r\n            let self: InternalMessageHandler = this;\r\n            return async function onMessage(request: ServiceRequest, _sender, _sendResponse) {\r\n                console.log(`blank received: `, request);\r\n                if (request.targetTabType === tabType) {\r\n                    self._onMessageForMyTabType?.(request);\r\n                    let tab = await chrome.tabs.getCurrent();\r\n                    if (request.targetTabId === tab.id) {\r\n                        self._onMessageForMe?.(request)\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        onMessageForMyTabType: function (callback: (msg: ServiceRequest) => void): MessageHandler {\r\n            this._onMessageForMyTabType = callback;\r\n            return this;\r\n        },\r\n        onMessageForMe: function (callback: (msg: ServiceRequest) => void): MessageHandler {\r\n            this._onMessageForMe = callback;\r\n            return this;\r\n        },\r\n        onData: function (callback: (data: any) => void): MessageHandler {\r\n            this._onData = callback;\r\n            return this;\r\n        },\r\n        _onMessageForMyTabType: undefined,\r\n        _onMessageForMe: undefined,\r\n        _onData: undefined\r\n    };\r\n    document.addEventListener(\"DOMContentLoaded\", async () => {\r\n        let res = await sendGetDataRequest(tabType);\r\n        handler._onData?.(res);\r\n    });\r\n    return handler;\r\n}","import {Actions, createMessageHandler, sendRequest, TabType} from \"./messaging\";\r\n\r\nlet handler  = createMessageHandler(TabType.Html);\r\n\r\nchrome.runtime.onMessage.addListener(handler.getListener());\r\n\r\nhandler\r\n    .onMessageForMyTabType(msg => {\r\n        console.log(\"message for my tab type: \", msg);\r\n        document.getElementById(\"container\").innerHTML = \"Message was for my tab type\" + msg.data;\r\n    })\r\n    .onMessageForMe(msg => {\r\n        console.log(\"message for me: \", msg);\r\n        document.getElementById(\"container\").innerHTML = \"DATA:\" + msg.data;\r\n    })\r\n    .onData(data => {\r\n        document.querySelector(\"button\").addEventListener(\"click\", async () => {\r\n            await sendRequest(Actions.GreetingsFromChild, TabType.Undefined, TabType.Main, undefined, \"Hullo! Fly safe!\");\r\n        });\r\n        console.log(\"tab opened: request data message sent and received: \");\r\n        console.log(data);\r\n        document.getElementById(\"container\").innerHTML = \"Dataxxxx:\" +  data.data;\r\n        document.title = data.pageTitle;\r\n    });\r\n"],"mappings":";;;;;AAAA,IAAY,8CAAL;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AACH;AAED,IAAY,8CAAL;AACH;AACA;AACA;AACA;;AACH;AAYD,SAAgB,YAAYA,QAAiBC,MAAeC,IAAcC,MAAcC,MAAWC,WAAoB;CACnH,IAAIC,MAAsB;EACtB;EACA;EACA;EACA,eAAe;EACf,eAAe;EACf,aAAa;CAChB;AACD,QAAO,OAAO,QAAQ,YAAY,IAAI;AACzC;AAOD,eAAsB,mBAAmBC,QAAiB;CACtD,IAAI,MAAM,MAAM,OAAO,KAAK,YAAY;AACxC,QAAO,MAAM,YAAY,QAAQ,YAAY,QAAQ,QAAQ,mBAAsB,EAAC,OAAO,IAAI,GAAG,EAAC;AACtG;AAeD,SAAgB,qBAAqBC,SAAkC;CACnE,IAAIC,YAAiC;EACjC,aAAa,WAAY;GACrB,IAAIC,OAA+B;AACnC,UAAO,eAAe,UAAUC,SAAyB,SAAS,eAAe;AAC7E,YAAQ,KAAK,mBAAmB,QAAQ;AACxC,QAAI,QAAQ,kBAAkB,SAAS;AACnC,UAAK,yBAAyB,QAAQ;KACtC,IAAI,MAAM,MAAM,OAAO,KAAK,YAAY;AACxC,SAAI,QAAQ,gBAAgB,IAAI,GAC5B,MAAK,kBAAkB,QAAQ;IAEtC;GACJ;EACJ;EACD,uBAAuB,SAAUC,UAAyD;AACtF,QAAK,yBAAyB;AAC9B,UAAO;EACV;EACD,gBAAgB,SAAUA,UAAyD;AAC/E,QAAK,kBAAkB;AACvB,UAAO;EACV;EACD,QAAQ,SAAUC,UAA+C;AAC7D,QAAK,UAAU;AACf,UAAO;EACV;EACD;EACA;EACA;CACH;AACD,UAAS,iBAAiB,oBAAoB,YAAY;EACtD,IAAI,MAAM,MAAM,mBAAmB,QAAQ;AAC3C,YAAQ,UAAU,IAAI;CACzB,EAAC;AACF,QAAOC;AACV;;;;AChGD,IAAI,UAAW,qBAAqB,QAAQ,KAAK;AAEjD,OAAO,QAAQ,UAAU,YAAY,QAAQ,aAAa,CAAC;AAE3D,QACK,sBAAsB,SAAO;AAC1B,SAAQ,IAAI,6BAA6B,IAAI;AAC7C,UAAS,eAAe,YAAY,CAAC,YAAY,gCAAgC,IAAI;AACxF,EAAC,CACD,eAAe,SAAO;AACnB,SAAQ,IAAI,oBAAoB,IAAI;AACpC,UAAS,eAAe,YAAY,CAAC,YAAY,UAAU,IAAI;AAClE,EAAC,CACD,OAAO,UAAQ;AACZ,UAAS,cAAc,SAAS,CAAC,iBAAiB,SAAS,YAAY;AACnE,QAAM,YAAY,QAAQ,oBAAoB,QAAQ,WAAW,QAAQ,cAAiB,mBAAmB;CAChH,EAAC;AACF,SAAQ,IAAI,uDAAuD;AACnE,SAAQ,IAAI,KAAK;AACjB,UAAS,eAAe,YAAY,CAAC,YAAY,cAAe,KAAK;AACrE,UAAS,QAAQ,KAAK;AACzB,EAAC"}