{
  "version": 3,
  "sources": ["../typescript/serviceworker.ts"],
  "sourcesContent": ["import MessageSender = chrome.runtime.MessageSender;\r\nimport {Actions, ServiceRequest, TabType} from \"./messaging\";\r\n\r\nlet defaultOptions = { //todo: integrate in options.ts.\r\n    showDebug: true,\r\n    showNotAssignedClasses: true,\r\n    markOtherAcademies: true,\r\n    otherAcademies: \"\"\r\n};\r\n\r\nchrome.runtime.onInstalled.addListener(() => {\r\n    console.log(\"installed.\");\r\n    chrome.storage.sync.get(\r\n        defaultOptions,\r\n        (items) => {\r\n            chrome.storage.sync.set(\r\n                {...defaultOptions, ...items},\r\n                () => {\r\n                    console.log(\"Options initialized\");\r\n                }\r\n            );\r\n        }\r\n    );\r\n});\r\n\r\nchrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {\r\n    console.log(\"service worker: tab updated: \", tabId, changeInfo.status);\r\n});\r\n\r\nchrome.tabs.onRemoved.addListener(function(tabId, removeInfo) {\r\n    console.log(\"service worker: tab removed: \", tabId);\r\n});\r\n\r\nlet global_request = {};\r\n\r\nchrome.runtime.onMessage.addListener( onMessage);\r\n\r\nlet mainTabId = -1;\r\nlet hoursSetupTabId = -1;\r\n\r\nfunction onMessage(message: ServiceRequest, sender: MessageSender, sendResponse: (response?: any) => void) {\r\n    switch (message.action) {\r\n        case Actions.OpenHtmlTab:\r\n            let url = chrome.runtime.getURL(\"resources/blank.html\");\r\n            global_request = message;\r\n            if(message.senderTabType === TabType.Main)\r\n                mainTabId = sender.tab.id;\r\n            chrome.tabs.create({url}).then(_tab => {\r\n                //TODO: store tab id?\r\n                sendResponse({tabId: _tab.id});\r\n            });\r\n            return true;\r\n        case Actions.OpenHoursSettings:\r\n            global_request = message;\r\n            mainTabId = sender.tab.id;\r\n            //todo: if already exists: activate?\r\n            chrome.tabs.create({url: chrome.runtime.getURL(\"resources/blank.html\")}).then(tab => {\r\n                hoursSetupTabId = tab.id;\r\n                console.log(\"hours setup tab created: \");\r\n                console.log(tab.id);\r\n                sendResponse({tabId: tab.id}); //todo: make a Response type.\r\n            });\r\n            return true; //needed because sendResponse is called asynchronously.\r\n        case Actions.GetTabData: //todo: move to sender instead of worker?\r\n            console.log(\"getTabData:\", message);\r\n            // if(message.senderTab === TabId.HoursSettings)\r\n            //     hoursSetupTabId = message.data.tabId;\r\n            sendResponse(global_request);\r\n            break;\r\n        case Actions.GetParentTabId:\r\n            sendResponse(mainTabId);\r\n            break;\r\n        // case Actions.GreetingsFromParent: {\r\n        //     console.log(\"passing greetings from parent to tab\");\r\n        //     let targetTabId: number;\r\n        //     if (message.targetTabType === TabType.HoursSettings)\r\n        //         targetTabId = hoursSetupTabId;\r\n        //     //todo: else?\r\n        //     chrome.tabs.sendMessage(targetTabId, message).then(r => {\r\n        //     });\r\n        // }            break;\r\n        case Actions.GreetingsFromChild: {\r\n            console.log(\"passing greetings from child to main\");\r\n            let targetTabId: number;\r\n            if (message.targetTabType === TabType.Main)\r\n                targetTabId = mainTabId;\r\n            //todo: else?\r\n            chrome.tabs.sendMessage(targetTabId, message).then(r => {\r\n            });\r\n            break;\r\n        }\r\n    }\r\n}\r\n"],
  "mappings": ";;AAGA,MAAI,iBAAiB;AAAA;AAAA,IACjB,WAAW;AAAA,IACX,wBAAwB;AAAA,IACxB,oBAAoB;AAAA,IACpB,gBAAgB;AAAA,EACpB;AAEA,SAAO,QAAQ,YAAY,YAAY,MAAM;AACzC,YAAQ,IAAI,YAAY;AACxB,WAAO,QAAQ,KAAK;AAAA,MAChB;AAAA,MACA,CAAC,UAAU;AACP,eAAO,QAAQ,KAAK;AAAA,UAChB,EAAC,GAAG,gBAAgB,GAAG,MAAK;AAAA,UAC5B,MAAM;AACF,oBAAQ,IAAI,qBAAqB;AAAA,UACrC;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ,CAAC;AAED,SAAO,KAAK,UAAU,YAAY,SAAS,OAAO,YAAY,KAAK;AAC/D,YAAQ,IAAI,iCAAiC,OAAO,WAAW,MAAM;AAAA,EACzE,CAAC;AAED,SAAO,KAAK,UAAU,YAAY,SAAS,OAAO,YAAY;AAC1D,YAAQ,IAAI,iCAAiC,KAAK;AAAA,EACtD,CAAC;AAED,MAAI,iBAAiB,CAAC;AAEtB,SAAO,QAAQ,UAAU,YAAa,SAAS;AAE/C,MAAI,YAAY;AAChB,MAAI,kBAAkB;AAEtB,WAAS,UAAU,SAAyB,QAAuB,cAAwC;AACvG,YAAQ,QAAQ,QAAQ;AAAA,MACpB;AACI,YAAI,MAAM,OAAO,QAAQ,OAAO,sBAAsB;AACtD,yBAAiB;AACjB,YAAG,QAAQ;AACP,sBAAY,OAAO,IAAI;AAC3B,eAAO,KAAK,OAAO,EAAC,IAAG,CAAC,EAAE,KAAK,UAAQ;AAEnC,uBAAa,EAAC,OAAO,KAAK,GAAE,CAAC;AAAA,QACjC,CAAC;AACD,eAAO;AAAA,MACX;AACI,yBAAiB;AACjB,oBAAY,OAAO,IAAI;AAEvB,eAAO,KAAK,OAAO,EAAC,KAAK,OAAO,QAAQ,OAAO,sBAAsB,EAAC,CAAC,EAAE,KAAK,SAAO;AACjF,4BAAkB,IAAI;AACtB,kBAAQ,IAAI,2BAA2B;AACvC,kBAAQ,IAAI,IAAI,EAAE;AAClB,uBAAa,EAAC,OAAO,IAAI,GAAE,CAAC;AAAA,QAChC,CAAC;AACD,eAAO;AAAA;AAAA,MACX;AACI,gBAAQ,IAAI,eAAe,OAAO;AAGlC,qBAAa,cAAc;AAC3B;AAAA,MACJ;AACI,qBAAa,SAAS;AACtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAUJ,oDAAiC;AAC7B,gBAAQ,IAAI,sCAAsC;AAClD,YAAI;AACJ,YAAI,QAAQ;AACR,wBAAc;AAElB,eAAO,KAAK,YAAY,aAAa,OAAO,EAAE,KAAK,OAAK;AAAA,QACxD,CAAC;AACD;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;",
  "names": []
}
